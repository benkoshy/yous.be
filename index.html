<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Yous</title><meta name="description" content="Blog for hackers."><link rel="stylesheet" href="/assets/main.css"><link rel="canonical" href="https://yous.be/"><link rel="alternate" type="application/rss+xml" title="Yous" href="https://yous.be/atom.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" href="/icon-192x192.png"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="mask-icon" color="#2568ba" href="/safari-pinned-tab.svg"><meta name="msapplication-TileColor" content="#2568ba"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta property="fb:admins" content="100001802412550"><meta property="og:title" content="Yous"><meta property="og:site_name" content="Yous"><meta property="og:url" content="https://yous.be/"><meta property="og:description" content="Blog for hackers."><meta property="og:image" content="http://yous.be/images/about/yous.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Yous"><meta name="twitter:description" content="Blog for hackers."><meta name="twitter:image:src" content="http://yous.be/images/about/yous.png"> <script type="text/javascript"> WebFontConfig = { google: { families: [ 'Bitter:400,700,400italic:latin' ] } }; (function(d) { var wf = d.createElement('script'), s = d.scripts[0]; wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js'; wf.async = true; s.parentNode.insertBefore(wf, s); })(document); </script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-43111808-1', 'auto'); ga('send', 'pageview'); </script><body><header class="site-header"><div class="wrapper"> <a class="site-title" href="/">Yous</a><nav class="site-nav"> <a class="page-link" href="/about/">About</a> <a class="page-link" href="/archives/">Archives</a></nav></div></header><main class="page-content" aria-label="Content"><div class="wrapper"><div class="home"><ul class="post-list"><li><header class="post-header"><h1 class="post-title"> <a class="post-link" href="/2017/11/14/how-to-make-a-bootable-usb-with-grub2-and-iso/">How to make a bootable USB with GRUB2 and ISO</a></h1><p class="post-meta"> Nov 14, 2017 • <a href="/categories/linux/">Linux</a></header><div class="post-content"><p>Do you have multiple ISO files to install, with quite enough storage of USB stick? You’ll want to install all of them with a single USB stick. Here’s how.<h2>Formatting USB disk</h2><p>First, plug in your USB stick and find it from your Linux machine:<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>fdisk <span class="nt">-l</span>
Disk /dev/sda: 20 GiB, 21474836480 bytes, 41943040 sectors
Units: sectors of 1 <span class="k">*</span> 512 <span class="o">=</span> 512 bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
Disklabel <span class="nb">type</span>: dos
Disk identifier: 0x4d149927

Device     Boot    Start      End  Sectors  Size Id Type
/dev/sda1  <span class="k">*</span>        2048 39845887 39843840   19G 83 Linux
/dev/sda2       39847934 41940991  2093058 1022M  5 Extended
/dev/sda5       39847936 41940991  2093056 1022M 82 Linux swap / Solaris


Disk /dev/sdb: 14.6 GiB, 15664676864 bytes, 30595072 sectors
Units: sectors of 1 <span class="k">*</span> 512 <span class="o">=</span> 512 bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
Disklabel <span class="nb">type</span>: gpt
Disk identifier: 4788154A-7BD2-4A06-945B-5980E828C8C5

Device      Start      End  Sectors  Size Type
/dev/sdb1      40   409639   409600  200M EFI System
/dev/sdb2  411648 30593023 30181376 14.4G Microsoft basic data
</code></pre></div></div><p>In my case, it’s <code class="highlighter-rouge">/dev/sdb</code>. Let’s format it with <code class="highlighter-rouge">fdisk</code>. When you run <code class="highlighter-rouge">fdisk /dev/sdb</code>, you can print help menu:<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>fdisk /dev/sdb

Welcome to fdisk <span class="o">(</span>util-linux 2.27.1<span class="o">)</span><span class="nb">.</span>
Changes will remain <span class="k">in </span>memory only, <span class="k">until </span>you decide to write them.
Be careful before using the write command.


Command <span class="o">(</span>m <span class="k">for </span><span class="nb">help</span><span class="o">)</span>: m

Help:

  Generic
   d   delete a partition
   F   list free unpartitioned space
   l   list known partition types
   n   add a new partition
   p   print the partition table
   t   change a partition <span class="nb">type
   </span>v   verify the partition table
   i   print information about a partition

  Misc
   m   print this menu
   x   extra functionality <span class="o">(</span>experts only<span class="o">)</span>

  Script
   I   load disk layout from sfdisk script file
   O   dump disk layout to sfdisk script file

  Save &amp; Exit
   w   write table to disk and <span class="nb">exit
   </span>q   quit without saving changes

  Create a new label
   g   create a new empty GPT partition table
   G   create a new empty SGI <span class="o">(</span>IRIX<span class="o">)</span> partition table
   o   create a new empty DOS partition table
   s   create a new empty Sun partition table
</code></pre></div></div><p>Now we can start!<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>fdisk /dev/sdb

Welcome to fdisk <span class="o">(</span>util-linux 2.27.1<span class="o">)</span><span class="nb">.</span>
Changes will remain <span class="k">in </span>memory only, <span class="k">until </span>you decide to write them.
Be careful before using the write command.


Command <span class="o">(</span>m <span class="k">for </span><span class="nb">help</span><span class="o">)</span>: o
Created a new DOS disklabel with disk identifier 0x8c9faeb0.

Command <span class="o">(</span>m <span class="k">for </span><span class="nb">help</span><span class="o">)</span>: n
Partition <span class="nb">type
   </span>p   primary <span class="o">(</span>0 primary, 0 extended, 4 free<span class="o">)</span>
   e   extended <span class="o">(</span>container <span class="k">for </span>logical partitions<span class="o">)</span>
Select <span class="o">(</span>default p<span class="o">)</span>:

Using default response p.
Partition number <span class="o">(</span>1-4, default 1<span class="o">)</span>:
First sector <span class="o">(</span>2048-30595071, default 2048<span class="o">)</span>:
Last sector, +sectors or +size<span class="o">{</span>K,M,G,T,P<span class="o">}</span> <span class="o">(</span>2048-30595071, default 30595071<span class="o">)</span>:

Created a new partition 1 of <span class="nb">type</span> <span class="s1">'Linux'</span> and of size 14.6 GiB.

Command <span class="o">(</span>m <span class="k">for </span><span class="nb">help</span><span class="o">)</span>: t
Selected partition 1
Partition <span class="nb">type</span> <span class="o">(</span><span class="nb">type </span>L to list all types<span class="o">)</span>: c
Changed <span class="nb">type </span>of partition <span class="s1">'Linux'</span> to <span class="s1">'W95 FAT32 (LBA)'</span><span class="nb">.</span>

Command <span class="o">(</span>m <span class="k">for </span><span class="nb">help</span><span class="o">)</span>: a
Selected partition 1
The bootable flag on partition 1 is enabled now.

Command <span class="o">(</span>m <span class="k">for </span><span class="nb">help</span><span class="o">)</span>: w
The partition table has been altered.
Calling ioctl<span class="o">()</span> to re-read partition table.
Syncing disks.
</code></pre></div></div><p>We’ve just created one bootable FAT partition, and that’ll be <code class="highlighter-rouge">/dev/sdb1</code>. Let’s create an MS-DOS filesystem in it. This will take a while.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>mkfs.vfat <span class="nt">-F</span> 32 /dev/sdb1
mkfs.fat 3.0.28 <span class="o">(</span>2015-05-16<span class="o">)</span>
</code></pre></div></div><p>Now you can mount that partition and we’re ready to install GRUB2 in it.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir</span> /mnt/usb
<span class="nb">sudo </span>mount /dev/sdb1 /mnt/usb
</code></pre></div></div><h2>Installing GRUB2</h2><p>Since we’re installing GRUB2 into USB stick, we specify <code class="highlighter-rouge">--removable</code> flag. Also specify <code class="highlighter-rouge">--boot-directory</code> so that GRUB2 is installed to there instead of <code class="highlighter-rouge">/boot/grub</code>.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>grub-install <span class="nt">--removable</span> <span class="nt">--boot-directory</span><span class="o">=</span>/mnt/usb/boot /dev/sdb
Installing <span class="k">for </span>i386-pc platform.
Installation finished. No error reported.
</code></pre></div></div><p>We’ll add <code class="highlighter-rouge">grub.cfg</code> file under <code class="highlighter-rouge">/mnt/usb/boot/grub/</code> directory. It defines selectable menus and the booting method of each entry. This time I’ll add Ubuntu Desktop ISO for i386 platform.<pre><code class="language-grub">set timeout=5
set default=0

menuentry "Ubuntu Desktop 16.04.3 LTS i386" {
  set isofile="/iso/ubuntu-16.04.3-desktop-i386.iso"
  loopback loop $isofile
  linux (loop)/casper/vmlinuz boot=casper file=/preseed/ubuntu.seed iso-scan/filename=$isofile noeject noprompt splash --
  initrd (loop)/casper/initrd.lz
}

menuentry "Ubuntu Desktop 16.04.3 LTS amd64" {
  set isofile="/iso/ubuntu-16.04.3-desktop-amd64.iso"
  loopback loop $isofile
  linux (loop)/casper/vmlinuz.efi boot=casper file=/preseed/ubuntu.seed iso-scan/filename=$isofile noeject noprompt splash --
  initrd (loop)/casper/initrd.lz
}

menuentry "Ubuntu Server 16.04.3 LTS i386" {
  set isofile="/iso/ubuntu-16.04.3-server-i386.iso"
  loopback loop $isofile
  linux (loop)/install/vmlinuz boot=casper file=/preseed/ubuntu-server.seed iso-scan/filename=$isofile noeject noprompt splash --
  initrd (loop)/install/initrd.gz
}

menuentry "Ubuntu Server 16.04.3 LTS amd64" {
  set isofile="/iso/ubuntu-16.04.3-server-amd64.iso"
  loopback loop $isofile
  linux (loop)/install/vmlinuz boot=casper file=/preseed/ubuntu-server.seed iso-scan/filename=$isofile noeject noprompt splash --
  initrd (loop)/install/initrd.gz
}

menuentry "Linux Mint 18.2 Cinnamon 32-bit" {
  set isofile="/iso/linuxmint-18.2-cinnamon-32bit.iso"
  loopback loop $isofile
  linux (loop)/casper/vmlinuz boot=casper file=/preseed/linuxmint.seed iso-scan/filename=$isofile noeject noprompt splash --
  initrd (loop)/casper/initrd.lz
}

menuentry "Custom ELF" {
  elffile="/elf/custom.elf"
  multiboot $elffile
}
</code></pre><p>In the first menuentry, <code class="highlighter-rouge">isofile</code> points to <code class="highlighter-rouge">/iso/ubuntu-16.04.3-desktop-i386.iso</code>, and it’s relative path of the USB stick. Create <code class="highlighter-rouge">/mnt/usb/iso/</code> directory, and put the ISO files under there.<p>You may need to look inside of ISO file to find where is <code class="highlighter-rouge">vmlinuz*</code> and <code class="highlighter-rouge">initrd.*</code> files. Try this:<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>isoinfo <span class="nt">-l</span> <span class="nt">-i</span> myimage.iso
</code></pre></div></div><p>As the similar way, you can also make it to boot from ELF file. Just put the ELF file that supports <a href="https://www.gnu.org/software/grub/manual/multiboot/multiboot.html">Multiboot</a> under <code class="highlighter-rouge">/mnt/usb/elf/</code> directory, and edit the menuentry properly.<p>After editing is done, unmount the disk and use it right away!<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>umount /dev/sdb1
</code></pre></div></div><h2>Troubleshooting</h2><p>If your screen goes black on boot, try with <code class="highlighter-rouge">nomodeset</code>:<pre><code class="language-grub">linux ... noeject noprompt splash nomodeset --
</code></pre><h2>See also</h2><ul><li><a href="https://help.ubuntu.com/community/Grub2/ISOBoot/Examples">Grub2/ISOBoot/Examples</a><li><a href="http://manpages.ubuntu.com/manpages/xenial/man7/casper.7.html">Ubuntu Manpage: casper</a></ul></div><li><header class="post-header"><h1 class="post-title"> <a class="post-link" href="/2017/03/07/pushing-git-repository-to-multiple-remotes/">Pushing git repository to multiple remotes</a></h1><p class="post-meta"> Mar 7, 2017 • <a href="/categories/git/">Git</a></header><div class="post-content"><p>I’m currently managing my dotfiles repository on both of <a href="https://github.com/yous/dotfiles">GitHub</a> and <a href="https://bitbucket.org/yous/dotfiles">Bitbucket</a>. These two repositories are the same, but I don’t want to remove one of them. I mainly use GitHub for hosting code now, but the first place I uploaded my dotfiles to was Bitbucket.<p>I want to keep the HEAD of two remote repositories be the same, so when I push code to my dotfiles, the both of them must be updated at the same time.<h2>Default git config</h2><p>First, clone or init the repository.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/yous/dotfiles.git
</code></pre></div></div><p>Then, as you know, the origin will be set to <code class="highlighter-rouge">https://github.com/yous/dotfiles.git</code>. This is the content of <code class="highlighter-rouge">.git/config</code>:<pre><code class="language-gitconfig">[core]
	# ...
[remote "origin"]
	url = https://github.com/yous/dotfiles.git
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch "master"]
	# ...
</code></pre><p>Note that there is the <code class="highlighter-rouge">url</code> attribute under <code class="highlighter-rouge">remote "origin"</code>.<h2>git remote set-url</h2><p>Now we’re going to run <code class="highlighter-rouge">git remote set-url</code> twice so that the repository will have two push remote URLs. Setting <em>push</em> remote URL is slightly different from plaing <code class="highlighter-rouge">git remote set-url &lt;name&gt; &lt;newurl&gt;</code>. See <code class="highlighter-rouge">man git-remote</code>:<pre><code class="language-man">set-url
    Changes URLs for the remote. Sets first URL for remote &lt;name&gt; that
    matches regex &lt;oldurl&gt; (first URL if no &lt;oldurl&gt; is given) to
    &lt;newurl&gt;. If &lt;oldurl&gt; doesn't match any URL, an error occurs and
    nothing is changed.

    With --push, push URLs are manipulated instead of fetch URLs.

    With --add, instead of changing existing URLs, new URL is added.
</code></pre><p>So we need to run <code class="highlighter-rouge">git remote set-url --push &lt;name&gt; &lt;newurl&gt;</code>. Moreover, we need two push URL, so the second command should be <code class="highlighter-rouge">git remote set-url --add --push &lt;name&gt; &lt;newurl&gt;</code>. It’s okay to specify <code class="highlighter-rouge">--add --push</code> to the first command, too.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote set-url <span class="nt">--add</span> <span class="nt">--push</span> origin https://github.com/yous/dotfiles.git
git remote set-url <span class="nt">--add</span> <span class="nt">--push</span> origin https://bitbucket.org/yous/dotfiles.git
</code></pre></div></div><p>Now, the content of <code class="highlighter-rouge">.git/config</code> would be like this:<pre><code class="language-gitconfig">[core]
	# ...
[remote "origin"]
	url = https://github.com/yous/dotfiles.git
	fetch = +refs/heads/*:refs/remotes/origin/*
	pushurl = https://github.com/yous/dotfiles.git
	pushurl = https://bitbucket.org/yous/dotfiles.git
[branch "master"]
	# ...
</code></pre><p>All done! Note that there are two <code class="highlighter-rouge">pushurl</code>s under <code class="highlighter-rouge">remote "origin"</code>. Now <code class="highlighter-rouge">git push</code> automatically pushes to the both push remote URLs.</div><li><header class="post-header"><h1 class="post-title"> <a class="post-link" href="/2017/03/01/boston-key-party-ctf-2017-vimjail-write-up/">Boston Key Party CTF 2017: vimjail write-up</a></h1><p class="post-meta"> Mar 1, 2017 • <a href="/categories/ctf/">CTF</a></header><div class="post-content"><h2>vimjail (pwn 150)</h2><blockquote><ul><li><code class="highlighter-rouge">ssh ctfuser@ec2-54-200-176-5.us-west-2.compute.amazonaws.com</code><li>password: <code class="highlighter-rouge">loginPWforVimJail</code></ul><p>Can you read the flag?<p><em>UPDATES</em><ul><li>(13:38 UTC Saturday): The flag is not in <code class="highlighter-rouge">/tmp</code>.<li>(13:31 EST Saturday): new ip</ul></blockquote><h2>Looking around</h2><p>Well, you would do <code class="highlighter-rouge">ls</code> first when you logged in, so do we. And there was <code class="highlighter-rouge">~/flagReader</code>.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctfuser@ip-172-31-31-196:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-als</span> /home/ctfuser/flagReader
12 <span class="nt">---S--x---</span> 1 topsecretuser secretuser 8768 Feb 25 08:42 /home/ctfuser/flagReader
</code></pre></div></div><p>If you try completion by pressing Tab key or try to move around using <code class="highlighter-rouge">cd</code>, it fails with an error message from rbash. It’s restricted bash, but you can simply run <code class="highlighter-rouge">bash</code> to escape.<p>While moving around, we found nothing special without <code class="highlighter-rouge">/.flag</code>. Also there were some <code class="highlighter-rouge">.s[a-z][a-z]</code> files under <code class="highlighter-rouge">/var/tmp/</code> and <code class="highlighter-rouge">/tmp/</code>, created by <code class="highlighter-rouge">secretuser</code>. But there are not in fixed location when the problem server was changed, so we thought there would be a way to run Vim under <code class="highlighter-rouge">secretuser</code>’s permission.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctfuser@ip-172-31-31-196:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-als</span> /.flag
4 <span class="nt">-r--------</span> 1 topsecretuser topsecretuser 39 Feb 25 08:42 /.flag
</code></pre></div></div><p>We also tried to find setuid or setgid files, but there was only the previous <code class="highlighter-rouge">flagReader</code>.<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctfuser@ip-172-31-31-196:/tmp<span class="nv">$ </span>find / <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-o</span> <span class="nt">-perm</span> <span class="nt">-2000</span> <span class="nt">-type</span> f 2&gt;/dev/null
/bin/ping
/bin/ping6
/bin/fusermount
/bin/umount
/bin/su
/bin/mount
/bin/ntfs-3g
/sbin/unix_chkpwd
/sbin/pam_extrausers_chkpwd
/usr/lib/x86_64-linux-gnu/utempter/utempter
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/openssh/ssh-keysign
/usr/lib/snapd/snap-confine
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/bin/crontab
/usr/bin/newuidmap
/usr/bin/at
/usr/bin/chage
/usr/bin/sudo
/usr/bin/bsd-write
/usr/bin/pkexec
/usr/bin/chfn
/usr/bin/expiry
/usr/bin/newgrp
/usr/bin/screen
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/newgidmap
/usr/bin/ssh-agent
/usr/bin/passwd
/usr/bin/mlocate
/home/ctfuser/flagReader
</code></pre></div></div></div><p class="post-continue"> <a href="/2017/03/01/boston-key-party-ctf-2017-vimjail-write-up/">Read on &rarr;</a><li><header class="post-header"><h1 class="post-title"> <a class="post-link" href="/2017/02/20/33c3-ctf-2016-pdfmaker-write-up/">33C3 CTF 2016: pdfmaker write-up</a></h1><p class="post-meta"> Feb 20, 2017 • <a href="/categories/ctf/">CTF</a></header><div class="post-content"><h2>pdfmaker (misc 75)</h2><blockquote><p>Just a tiny <a href="https://archive.aachen.ccc.de/33c3ctf.ccc.ac/uploads/pdfmaker-023c4ad945cb421a8bec1013bddf2bab5f77f77a.tar.xz">application</a>, that lets the user write some files and compile them with pdflatex. What can possibly go wrong?<p><code class="highlighter-rouge">nc 78.46.224.91 24242</code></blockquote><p>If you can’t download the application, please use this <a href="/downloads/2017/02/20/pdfmaker-023c4ad945cb421a8bec1013bddf2bab5f77f77a.tar.xz">link</a>.<h2>What is the goal?</h2><p>There are some interesting parts in <code class="highlighter-rouge">pdfmaker_public.py</code>. <code class="highlighter-rouge">initConnection</code> copies <code class="highlighter-rouge">flag</code> file into the <code class="highlighter-rouge">self.directory</code> with the name of:<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"33C3"</span> <span class="o">+</span> <span class="s">"</span><span class="si">%</span><span class="s">X"</span> <span class="o">%</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">)</span> <span class="o">+</span> <span class="s">"</span><span class="si">%</span><span class="s">X"</span> <span class="o">%</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">)</span>
</code></pre></div></div><p>Since the answer would be in the <code class="highlighter-rouge">33C3XXXXXXXXXXXXXXXX</code> file, we should get the list of filenames in its directory. Note that <code class="highlighter-rouge">create</code> method can create log, tex, sty, mp, bib files.<h2>Behavior of <code class="highlighter-rouge">\write18</code></h2><p><a href="http://gsis.kaist.ac.kr/cysec/daeheejang.html">@daehee</a> found this helpful link: <a href="http://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/">“Pwning coworkers thanks to LaTeX”</a>. According to the post, <code class="highlighter-rouge">\write18</code> normally executes any program listed in <code class="highlighter-rouge">shell_escape_commands</code>:<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shell_escape_commands</span> = \
<span class="n">bibtex</span>,<span class="n">bibtex8</span>,\
<span class="n">extractbb</span>,\
<span class="n">kpsewhich</span>,\
<span class="n">makeindex</span>,\
<span class="n">mpost</span>,\
<span class="n">repstopdf</span>,\
</code></pre></div></div><p>Note that <code class="highlighter-rouge">mpost</code> is in there, and we can create mp file! As denoted by the link, <code class="highlighter-rouge">mpost</code> takes the <code class="highlighter-rouge">-tex</code> option for text labels, so we can execute arbitrary program.</div><p class="post-continue"> <a href="/2017/02/20/33c3-ctf-2016-pdfmaker-write-up/">Read on &rarr;</a><li><header class="post-header"><h1 class="post-title"> <a class="post-link" href="/2016/10/11/hitcon-ctf-2016-rop-write-up/">HITCON CTF 2016: ROP write-up</a></h1><p class="post-meta"> Oct 11, 2016 • <a href="/categories/ctf/">CTF</a></header><div class="post-content"><h2>ROP (Reverse 250)</h2><blockquote><p><strong>Description</strong><p>Who doesn’t like ROP?<br /> Let’s try some new features introduced in 2.3.<p><a href="https://s3-ap-northeast-1.amazonaws.com/hitcon2016qual/rop.iseq_a9ac4b7a1669257d0914ca556a6aa6d14b4a2092">rop.iseq</a><p><strong>Hint</strong><p>None</blockquote><p>If the above link doesn’t work, please use this <a href="/downloads/2016/10/11/rop.iseq_a9ac4b7a1669257d0914ca556a6aa6d14b4a2092">link</a>.<h2>New features?</h2><p>Well, see <a href="https://www.ruby-lang.org/en/news/2015/12/25/ruby-2-3-0-released/">the Ruby 2.3.0 news</a>.<blockquote><p><a href="https://bugs.ruby-lang.org/issues/11788">RubyVM::InstructionSequence#to_binary and .load_from_binary</a> are introduced as experimental features. With these features, we can make a ISeq (bytecode) pre-compilation system.</blockquote><p>Yes, so this is about using <code class="highlighter-rouge">RubyVM::InstructionSequence.load_from_binary</code>. Let’s just start with:<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">RubyVM</span><span class="o">::</span><span class="no">InstructionSequence</span><span class="p">.</span><span class="nf">load_from_binary</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'rop.iseq'</span><span class="p">))</span>
</code></pre></div></div><p>But you can face this kind of error:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RuntimeError: unmatched platform
        from (irb):1:in `load_from_binary'
        from (irb):1
        from /usr/bin/irb:11:in `&lt;main&gt;'
</code></pre></div></div><p>By checking <code class="highlighter-rouge">strings rop.iseq</code>, we can find <code class="highlighter-rouge">x86_64-linux</code>. So we need Ruby 2.3 on Linux x86_64 platform. You can see the platform by <code class="highlighter-rouge">ruby --version</code>. This is the version of my one:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]
</code></pre></div></div></div><p class="post-continue"> <a href="/2016/10/11/hitcon-ctf-2016-rop-write-up/">Read on &rarr;</a></ul><div class="pagination"> <a class="previous" href="/posts/2/">&laquo; Older</a></div></div></div></main><footer class="site-footer"><div class="wrapper"><p> Content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a><br /> &copy; 2013&ndash;2018 - <a href="/about/">Yous</a> - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://yous.be/atom.xml">RSS</a></div></footer>
